

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>模块化RAG和RAG流程 作者： 程序员二狗蛋 来源： 程序员二狗蛋 RAG 的压缩和高级总结。 在第一部分中，我们将重点介绍模块化 RAG 的概念和组件，包含 6 种模块类型、14 个模块和 40 多个运算符。 介绍 在过去的一年里，检索增强生成（RAG） 的概念作为实施 LLM 申请的方法引起了相当多的关注。我  | AiBard123| ai工具网址导航,ai最新产品</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AI聊天,AI文本生成,AI绘画,AI编程,AI电商" />
    <meta name="description" content="AiBard123 网址导航 | 免费chatgpt 汇集各类先进的人工智能产品，旨在帮助用户更快速地了解和使用这些产品,轻松地浏览不同领域的AI产品，包括语音识别、图像处理、自然语言处理。" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://aibard123.com/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                        <a href="https://aibard123.com/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>本月热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>热门网站</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>国内热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>对话工具</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>写作</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像处理</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音视频</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音乐生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>办公</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>提示词</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>编程</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AI搜索</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>文本翻译</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>学习网站</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>友情链接</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI 文摘
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">模块化RAG和RAG流程</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://aibard123.com/about>AiBard123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              April 18, 2024 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5yYEg4CRMhYEDVp1kKyLBia0uXJWWSxCG5Qr7g6TWIiceA7jCX7Dvg3ibw/640?wx_fmt=png&amp;from=appmsg" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <p>作者： 程序员二狗蛋  来源： <a href="https://mp.weixin.qq.com/s/4WlolLlMKj1a6aubPFTR1w">程序员二狗蛋</a></p>
<blockquote>
<p>RAG 的压缩和高级总结。</p>
<p>在第一部分中，我们将重点介绍模块化 RAG 的概念和组件，包含 6 种模块类型、14 个模块和 40 多个运算符。</p>
</blockquote>
<h4 id="介绍">介绍</h4>
<p><strong>在过去的一年里，检索增强生成（RAG）</strong> 的概念作为实施 LLM 申请的方法引起了相当多的关注。我们撰写了有关 RAG 的综合调查，深入探讨了从 Naive RAG 到 Advanced RAG 和 Modular RAG 的转变。然而，该调查主要通过增强的视角（例如增强源/阶段/过程）来审查 RAG 技术。</p>
<p>本文将特别关注模块化 RAG 范例。我们进一步定义了<strong>三层模块化 RAG</strong> 范例，包括<strong>Module Type</strong> 、<strong>Module</strong> 和<strong>Operator 。</strong> 在此范式下，我们阐述了当前RAG系统中的核心技术，包括6大模块类型、14个模块和40+算子，旨在提供对RAG的全面理解。</p>
<p>通过编排不同的运算符，我们可以派生出各种<strong>RAG Flows</strong> ，这是我们旨在在本文中阐明的概念。经过广泛的研究，我们提炼和总结了典型模式、几个具体实施案例和最佳行业案例。（由于篇幅限制，这部分内容将在第二部分中讨论。）</p>
<p>本文的目的是提供<strong>对</strong> RAG 开发现状的更深入的理解，并为未来的发展铺平道路。模块化 RAG 提供了大量机会，有助于定义新运算符、模块以及新流程的配置。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5JLk4rjWQz7X7aodaxypUWmeAF2O45NJ5nmB07BpY1ArdANtNLesiaXQ/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>RAG 调查中的数据</p>
<h4 id="什么是模块化-rag">什么是模块化 RAG？</h4>
<p>RAG的进步带来了更加多样化和灵活的流程，具体表现在以下几个关键方面：</p>
<p>0.<strong>增强的数据采集：</strong>  RAG 已经超越了传统的非结构化数据，现在包括半结构化和结构化数据，重点是预处理结构化数据，以改进检索并减少模型对外部知识源的依赖。</p>
<p>1.<strong>合并技术</strong> ：RAG 正在与其他技术集成，包括使用微调、适配器模块和强化学习来增强检索能力。</p>
<p>2.<strong>适应性强的检索过程</strong> ：检索过程已经发展到支持多轮检索增强，使用检索到的内容来指导生成，反之亦然。此外，自主判断和LLM的使用通过确定检索的需要提高了回答问题的效率。</p>
<p><strong>模块化 RAG 的定义</strong></p>
<p>从上图可以看出，RAG的快速发展已经超越了<strong>链式高级RAG</strong> 范式，呈现出模块化的特点。为了解决当前缺乏组织和抽象的问题，我们提出了一种模块化 RAG 方法，该方法无缝集成了 Naive RAG 和 Advanced RAG 的开发范例。</p>
<p>模块化RAG提出了一种高度<strong>可扩展的</strong> 范例，将RAG系统分为模块类型、模块和操作符的<strong>三层</strong> 结构。每个Module Type代表RAG系统中的一个核心流程，包含多个功能模块。每个功能模块又包含多个特定的操作符。整个RAG系统变成了多个模块和相应算子的排列组合，形成了我们所说的RAG Flow。在流程中，每种模块类型可以选择不同的功能模块，并且在每个功能模块中可以选择一个或多个操作符。</p>
<p><strong>与之前范式的关系</strong></p>
<p>模块化 RAG 以多层模块化形式组织 RAG 系统。Advanced RAG 是 RAG 的模块化形式，Naive RAG 是 Advanced RAG 的特例。三种范式之间是一种继承与发展的关系。</p>
<p><strong>模块化 RAG 的机会</strong></p>
<p>模块化 RAG 的好处是显而易见的，它为现有的 RAG 相关工作提供了全新且全面的视角。通过模块化的组织，清晰地总结了相关的技术和方法。</p>
<p><em><strong>研究视角</strong> 。模块化 RAG 具有高度可扩展性，有助于研究人员在全面了解当前 RAG 发展的基础上</em><em>提出新的模块类型、模块和算子。</em>*</p>
<p><em><strong>应用视角。</strong>  RAG系统的设计和构建变得更加便捷，用户可以根据现有数据、使用场景、下游任务等需求定制RAG Flow。开发者还可以参考现有的Flow构建方法，根据不同的应用场景和领域</em><em>定义新的流程和模式。</em>*</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5MOQztZMtx56aibw2nUvIXzU2XvxBVg8pDlPDRD0vam2GMWueLiccRV9g/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>模块化RAG的框架</p>
<h4 id="模块类型--模块--运算符">模块类型 — 模块 — 运算符</h4>
<blockquote>
<p>在本章中，我们将深入研究 RAG 的三层结构并构建 RAG 的技术路线图。由于篇幅限制，我们不会深入探讨技术细节；但是，将提供全面的参考资料以供进一步阅读。</p>
</blockquote>
<h4 id="1-索引">1. 索引</h4>
<p>索引是将文本分解为可管理块的过程，是组织系统的关键步骤，面临三个主要挑战：</p>
<p>*<strong>内容表示不完整。</strong> 块的语义信息受到分割方法的影响，导致较长上下文中重要信息的丢失或淹没。</p>
<p>*<strong>不准确的块相似性搜索。</strong> 随着数据量的增加，检索中的噪声也随之增大，导致频繁匹配错误数据，导致检索系统脆弱且不可靠。</p>
<p>*<strong>参考轨迹不明确。</strong> 检索到的块可能源自任何文档，没有引用轨迹，可能导致存在来自多个不同文档的块，尽管这些文档在语义上相似，但包含完全不同主题的内容。</p>
<h4 id="块优化">块优化</h4>
<p>较大的块可以捕获更多的上下文，但它们也会产生更多的噪音，需要更长的处理时间和更高的成本。虽然较小的块可能无法完全传达必要的上下文，但它们确实具有较少的噪音。</p>
<p>*<strong>滑动窗口</strong></p>
<p>平衡这些需求的一种简单方法是使用重叠块。通过使用滑动窗口，可以增强语义转换。然而，它也存在局限性，包括对上下文大小的不精确控制、截断单词或句子的风险以及缺乏语义考虑。</p>
<p>*<strong>从小到大</strong></p>
<p>关键思想是将用于检索的块与用于合成的块分开。使用较小的块可以提高检索的准确性，而较大的块可以提供更多的上下文信息。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5yYEg4CRMhYEDVp1kKyLBia0uXJWWSxCG5Qr7g6TWIiceA7jCX7Dvg3ibw/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>具体来说，一种方法可能涉及检索<strong>较小的块</strong> ，然后<strong>引用父 ID</strong> 以返回较大的块。或者，可以检索单个句子，并返回该句子<strong>周围的文本窗口。</strong></p>
<p>详细信息和LlamaIndex 实施。</p>
<p>*<strong>概括</strong></p>
<p>它类似于从小到大的概念，首先生成较大块的摘要，然后对摘要执行检索。随后，可以对较大的块进行二次检索。</p>
<p>*<strong>元数据附件</strong></p>
<p>可以用元数据信息来丰富块，例如<strong>页码</strong> 、<strong>文件名、作者、时间戳、摘要</strong> 或块可以回答的问题。随后，可以根据该元数据过滤检索，从而限制搜索范围。请参阅LlamaIndex中的实现。</p>
<h4 id="结构组织">结构组织</h4>
<p>增强信息检索的一种有效方法是建立文档的层次结构。通过构建块结构，RAG系统可以加快相关数据的检索和处理。</p>
<p>*<strong>层次索引</strong></p>
<p>在文档的层次结构中，节点以父子关系排列，块链接到它们。数据摘要存储在每个节点上，有助于快速遍历数据并协助 RAG 系统确定要提取哪些块。这种方法还可以减轻由块提取问题引起的错觉。</p>
<p>构建结构化索引的方法主要有：</p>
<ul>
<li>文档中的<strong>结构意识.段落和句子分段</strong></li>
</ul>
<p>*<strong>内容意识。</strong>  PDF、HTML、Latex 中的固有结构</p>
<p>*<strong>语义感知</strong> 。基于 NLP 技术的文本语义识别和分割，例如利用 NLTK。</p>
<p>大规模检查Arcus的层次索引。</p>
<p>*<strong>KG 组织文档</strong></p>
<p>利用知识图（KG）构建文档的层次结构有助于保持一致性。它描绘了不同概念和实体之间的联系，显着减少了产生幻觉的可能性。</p>
<p>另一个优点是将信息检索过程转化为LLM可以理解的指令，从而提高知识检索的准确性，并使LLM能够生成上下文连贯的响应，从而提高RAG系统的整体效率。</p>
<p>检查Neo4j 实现和LllmaIndex Neo4j 查询引擎。</p>
<p>关于使用KG组织多个文档，可以参考这篇研究论文<strong>KGP：Knowledge Graph Prompting for Multi-Document Question Answering****。</strong></p>
<h4 id="2-预检索">2. 预检索</h4>
<p>Naive RAG 的主要挑战之一是它直接依赖用户的原始查询作为检索的基础。提出精确而清晰的问题很困难，不谨慎的查询会导致检索效率不佳。</p>
<p>这一阶段的主要挑战包括：</p>
<p>*<strong>措辞不当的查询。</strong> 问题本身很复杂，语言也没有很好的组织。</p>
<p><em><strong>语言的复杂性和歧义性。</strong> 在处理专业词汇或具有多种含义的模糊缩写时，语言模型通常会遇到困难。例如，他们可能无法辨别“LLM”是指</em>大语言模型<em>还是法律背景下的</em>LLM。*</p>
<h4 id="查询扩展">查询扩展</h4>
<p>将单个查询扩展到多个查询可以丰富查询的内容，提供进一步的上下文来解决任何缺乏特定细微差别的问题，从而确保生成的答案的最佳相关性。</p>
<ul>
<li><em>Multi-Query</em></li>
</ul>
<p>通过采用即时工程通过LLM扩展查询，这些查询可以并行执行。查询的扩展不是随意的，而是经过精心设计的。此设计的两个关键标准是查询的<strong>多样性</strong> 和<strong>覆盖范围。</strong></p>
<p>使用多个查询的挑战之一是可能会<strong>削弱</strong> 用户的原始意图。为了缓解这种情况，我们可以指示模型在提示工程中为原始查询分配更大的权重。</p>
<ul>
<li><em>Sub-Query</em></li>
</ul>
<p>子问题规划的过程代表了必要的子问题的生成，以便在组合时将原始问题结合起来并充分回答原始问题。原则上，添加相关上下文的过程类似于查询扩展。具体来说，可以使用从<strong>最少****到最多的提示</strong> 方法将一个复杂的问题分解为一系列较简单的子问题。</p>
<ul>
<li><em>CoVe</em></li>
</ul>
<p>另一种查询扩展方法涉及使用Meta AI 提出的<strong>验证链（CoVe）</strong>  。扩展的查询经过LLM的验证，以达到减少幻觉的效果。经过验证的扩展查询通常表现出更高的可靠性。</p>
<h4 id="查询转换">查询转换</h4>
<blockquote>
<p>使用转换后的查询而不是用户的原始查询来检索和生成。</p>
</blockquote>
<ul>
<li><em>Rewrite</em></li>
</ul>
<p>原始查询并不总是最适合 LLM 检索，尤其是在现实场景中。因此，我们可以提示LLM重写查询。除了使用LLM进行查询重写之外，还可以利用专门的较小语言模型，例如<strong>RRR（Rewrite-retrieve-read） 。</strong></p>
<p>淘宝促销系统中Query Rewrite方法的实施，即<strong>BEQUE：Query Rewriting for Retrieval-Augmented Large Language Models</strong> ，显着提高了长尾查询的召回率，从而带来了GMV的上升。</p>
<p>*<strong>HyDE</strong></p>
<p>当响应查询时，LLM 构建假设文档（假设答案），而不是直接在向量数据库中搜索查询及其计算向量。它侧重于嵌入答案之间的相似性，而不是寻求问题或查询的嵌入相似性。此外，它还包括<strong>Reverse HyDE</strong> ，它专注于从查询到查询的检索。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5g7p98OSZhWLuY2TRrUgY2icsyHO35tkExFsZNPcDbtblCP2njvLdicJQ/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>HyDE 和 Reverse HyDE 的核心思想都是在查询和答案之间架起映射的桥梁。</p>
<ul>
<li><em>Step-back Prompting</em></li>
</ul>
<p>使用Google DeepMind提出的Step-back Prompting方法，对原始查询进行抽象，生成高级概念问题（step-back Question）。在RAG系统中，后退问题和原始查询都用于检索，并且这两种结果都被用作语言模型答案生成的基础。</p>
<h4 id="query-routing">Query Routing</h4>
<h4 id="heading"></h4>
<p>基于不同的查询，路由到不同的RAG管道，适用于旨在适应不同场景的多功能RAG系统。</p>
<p>*<strong>元数据路由器/过滤器</strong></p>
<p>第一步涉及从查询中提取关键字（实体），然后根据块中的关键字和元数据进行过滤以缩小搜索范围。</p>
<p>*<strong>语义路由器</strong></p>
<p>另一种路由方法涉及利用查询的语义信息。具体方法参见语义路由器。当然，也可以采用混合路由方法，结合语义和基于元数据的方法来增强查询路由。</p>
<p>检查语义路由器存储库。</p>
<h4 id="查询构造">查询构造</h4>
<p>将用户的查询转换为另一种查询语言以访问替代数据源。常见的方法包括：</p>
<ul>
<li>
<p><em>Text-to-Cypher</em></p>
</li>
<li>
<p><em>Text-to-SQL</em></p>
</li>
</ul>
<p>在许多场景中，结构化查询语言（例如SQL、Cypher）通常与语义信息和元数据结合使用来构造更复杂的查询。具体详情请参考Langchain博客。</p>
<h4 id="3-retrieval">3 Retrieval</h4>
<h4 id="heading-1"></h4>
<p>检索过程在 RAG 中起着至关重要的作用。利用强大的 PLM 可以有效表示潜在空间中的查询和文本，从而促进问题和文档之间建立语义相似性以支持检索。</p>
<p>需要考虑三个主要因素：</p>
<p>*<strong>检索效率</strong></p>
<p>*<strong>嵌入质量</strong></p>
<p>*<strong>任务、数据和模型的协调</strong></p>
<h4 id="retriver-selection">Retriver Selection</h4>
<h4 id="heading-2"></h4>
<p>自 ChatGPT 发布以来，嵌入模型出现了疯狂的发展。Hugging Face 的<strong>MTEB</strong> 排行榜评估了 8 个任务中几乎所有可用的嵌入模型——聚类、分类、Bittext Ming、Pair Classification、Reranking、Retrieval、语义文本相似度 (STS) ）和摘要，覆盖58个数据集此外，<strong>C-MTEB</strong> 专注于评估中国嵌入模型的能力，覆盖6个任务和35个数据集。</p>
<p>在构建 RAG 应用程序时，对于“使用哪种嵌入模型”没有一刀切的答案。但是，您可能会注意到特定的嵌入更适合特定的用例。</p>
<p>查看 MTEB/C-MTEB 排行榜。</p>
<p>*<strong>稀疏检索器</strong></p>
<p>虽然稀疏编码模型可能被认为是一种有些过时的技术，通常基于词频统计等统计方法，但由于其更高的编码效率和稳定性，它们仍然占有一定的地位。常见的系数编码模型包括<strong>BM25</strong> 和<strong>TF-IDF。</strong></p>
<ul>
<li><em>Dense Retriever</em></li>
</ul>
<p>基于神经网络的密集编码模型包括以下几种类型：</p>
<ul>
<li>
<p>基于 BERT 架构构建的 Encoder-Decoder 语言模型，例如 ColBERT。</p>
</li>
<li>
<p>全面的多任务微调模型，如 BGE 和 Baichuan-Text-Embedding。</p>
</li>
<li>
<p>基于云 API 的模型，例如 OpenAI-Ada-002 和 Cohere Embedding。</p>
</li>
<li>
<p>下一代加速编码框架Dragon+，专为大规模数据应用而设计。</p>
</li>
<li>
<p><em>Mix/hybrid Retrieval</em></p>
</li>
</ul>
<p>两种嵌入方法捕获不同的相关性特征，并且可以通过利用互补的相关性信息来相互受益。例如，稀疏检索模型可用于为训练密集检索模型提供初始搜索结果。此外，PLM 可用于学习术语权重以增强稀疏检索。具体来说，它还表明稀疏检索模型可以增强密集检索模型的零样本检索能力，并协助密集检索器处理包含稀有实体的查询，从而提高鲁棒性。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/jqCXiaOg1c0VsicwiaC4FbF7tzaicmR79PJ5Cmib8OCUGdVOvl1iacQ24nqMaUVz2ujrt8TEwTYYlibUQib7qSQtUrMcjA/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>图片来自IVAN ILIN：高级 RAG 技术：图解概述</p>
<h4 id="retriever-fine-tuning">Retriever Fine-tuning</h4>
<h4 id="heading-3"></h4>
<p>如果上下文可能与预训练模型在嵌入空间中认为相似的内容不同，特别是在高度专业化的领域，如医疗保健、法律和其他富含专有术语的领域，调整嵌入模型可以解决这个问题。虽然这种调整需要额外的努力，但它可以显着提高检索效率和域对齐。</p>
<p>*<strong>SFT</strong></p>
<p>您可以根据特定领域的数据构建自己的微调数据集，这一任务可以使用 LlamaIndex 快速完成。</p>
<p>*<strong>LSR（LM 监督猎犬）</strong></p>
<p>与直接从数据集构建微调数据集相比，LSR 利用 LM 生成的结果作为监督信号，在 RAG 过程中微调嵌入模型。</p>
<p>*<strong>RL（</strong> 强化学习）</p>
<p>受到 RLHF（Reinforcement Learning from Human Feedback）的启发，利用基于 LM 的反馈通过强化学习来强化 Retriever。</p>
<p>*<strong>Adapter</strong></p>
<p>有时，微调整个检索器的成本可能很高，尤其是在处理无法直接微调的基于 API 的检索器时。在这种情况下，我们可以通过合并适配器模块并进行微调来缓解这种情况。添加适配器的另一个好处是能够更好地与特定下游任务保持一致。</p>
<ul>
<li>
<p>任务特定。PRCA：通过可插入奖励驱动的上下文适配器拟合黑盒大型语言模型以进行检索问题回答。</p>
</li>
<li>
<p>任务无关。AAR （增强自适应检索器）引入了一个通用适配器，旨在适应多个下游任务。</p>
</li>
</ul>
<h4 id="4-post-retrieval">4 Post-Retrieval</h4>
<h4 id="heading-4"></h4>
<p>检索整个文档块并将其直接输入到 LLM 的上下文环境中并不是最佳选择。对文档进行后处理可以帮助LLM更好地利用上下文信息。</p>
<p>主要挑战包括：</p>
<p>*<strong>中间迷失了</strong> 。与人类一样，LLM倾向于只记住长文本的开头和结尾，而忘记中间部分。</p>
<p>*<strong>噪音/反事实块</strong> 。检索到的嘈杂或事实上矛盾的文档可能会影响最终的检索生成。</p>
<p>*<strong>上下文窗口。</strong> 尽管检索了大量相关内容，但大型模型中上下文信息长度的限制阻止了所有这些内容的包含。</p>
<h4 id="rerank">Rerank</h4>
<h4 id="heading-5"></h4>
<p>在不改变其内容或长度的情况下对检索到的文档块进行重新排序，以增强 LLM 更重要的文档块的可见性。具体来说：</p>
<p>*<strong>基于规则的重新排序</strong></p>
<p>根据某些规则，计算指标以对块进行重新排序。常见指标包括：</p>
<ul>
<li>
<p>多样性</p>
</li>
<li>
<p>关联</p>
</li>
<li>
<p>MRR（最大边际相关性，1998）</p>
</li>
</ul>
<p>MMR 背后的想法是减少冗余并增加结果多样性，它用于文本摘要。MMR 根据查询相关性和信息新颖性的组合标准在最终关键短语列表中选择短语。</p>
<p>检查 HayStack 中是否有 rerank 实现</p>
<p>*<strong>基于模型的重新排序</strong></p>
<p>利用语言模型对文档块重新排序，选项包括：</p>
<ul>
<li>
<p>BERT 系列的编码器-解码器模型，例如 SpanBERT</p>
</li>
<li>
<p>专门的重新排名模型，例如Cohere rerank或bge-raranker-large</p>
</li>
<li>
<p>通用大型语言模型，例如GPT-4</p>
</li>
</ul>
<h4 id="compression-and-selection">Compression and Selection</h4>
<h4 id="heading-6"></h4>
<p>RAG 过程中的一个常见误解是认为检索尽可能多的相关文档并将它们连接起来形成冗长的检索提示是有益的。然而，过多的上下文可能会引入更多的噪音，削弱LLM对关键信息的感知，并导致“迷失在中间”等问题。解决此问题的常见方法是压缩并选择检索到的内容。</p>
<p>*<strong>（长）LLM语言</strong></p>
<p>通过利用经过对齐和训练的小语言模型，例如 GPT-2 Small 或 LLaMA-7B，可以实现从提示中检测和删除不重要的标记，将其转换为人类难以理解但LLM可以很好理解的形式。这种方法提供了一种直接且实用的即时压缩方法，无需对LLM进行额外培训，同时平衡语言完整性和压缩率。</p>
<p>检查LLMLingua 项目。</p>
<p>*<strong>重组</strong></p>
<p>Recomp引入了两种类型的压缩器：<strong>提取压缩器</strong> 从检索到的文档中选择相关句子，<strong>抽象压缩器</strong> 通过合并多个文档中的信息来生成简洁的摘要。当生成的摘要被添加到语言模型的输入之前时，这两个压缩器都经过训练以增强语言模型在最终任务上的性能，同时确保摘要的简洁性。在检索到的文档与输入无关或不向语言模型提供附加信息的情况下，压缩器可以返回空字符串，从而实现选择性增强。</p>
<p>*<strong>选择性背景</strong></p>
<p>通过<strong>识别并去除输入上下文中的冗余内容</strong> ，可以简化输入，从而提高语言模型的推理效率。选择性上下文类似于“停用词删除”策略。在实践中，选择性上下文根据基本语言模型计算的自信息来评估词汇单元的信息内容。通过保留具有更高自信息的内容，该方法为语言模型处理提供了更简洁、更高效的文本表示，而不会影响其在不同应用程序中的性能。然而，它忽略了压缩内容之间的相互依赖性以及目标语言模型和用于提示压缩的小语言模型之间的一致性。</p>
<p>*<strong>标记过滤器</strong></p>
<p>标记是一种相对直观且直接的方法。具体来说，首先对文档进行标记，然后根据查询的元数据进行过滤。</p>
<p>*<strong>LLM批判</strong></p>
<p>另一种简单有效的方法是让LLM在生成最终答案之前评估检索到的内容。这使得LLM能够通过LLM批判过滤掉相关性较差的文档。例如，在Chatlaw中，LLM被提示对所引用的法律条款进行自我建议，以评估其相关性。</p>
<h4 id="5-生成">5 生成</h4>
<p>利用 LLM 根据用户的查询和检索到的上下文信息生成答案。</p>
<h4 id="generation-selection">Generation Selection</h4>
<h4 id="heading-7"></h4>
<p>根据场景的不同，LLM的选择可以分为以下两种类型：</p>
<p>*<strong>基于云 API 的生成器</strong></p>
<p>基于云API 通过调用第三方LLM的API来利用第三方LLM，例如OpenAI的ChatGPT、GPT-4和Anthropic Claude等。<strong>好处：</strong></p>
<ul>
<li>
<p>无服务器压力</p>
</li>
<li>
<p>高并发</p>
</li>
<li>
<p>能够使用更强大的模型</p>
</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>
<p>数据经过第三方，导致数据隐私问题</p>
</li>
<li>
<p>无法调整模型（在绝大多数情况下）</p>
</li>
</ul>
<p>*<strong>本地部署</strong></p>
<p>本地部署的开源或自研的LLM，例如Llama系列、GLM等。优点和缺点与基于Cloud API的模型相反。本地部署的模型提供了更大的灵活性和更好的隐私保护，但需要更高的计算资源。</p>
<h4 id="generator-微调">Generator 微调</h4>
<p>除了直接使用LLM外，根据场景和数据特征进行有针对性的微调可以收到更好的效果。这也是使用本地设置的最大优势之一。常见的微调方法有以下几种：</p>
<ul>
<li><em>SFT</em></li>
</ul>
<p>当LLM缺乏特定领域的数据时，可以通过微调为LLM提供额外的知识。Huggingface 的微调数据也可以用作初始步骤。</p>
<p>微调的另一个好处是能够调整模型的输入和输出。例如，它可以使LLM适应特定的数据格式并按照指示生成特定风格的响应。</p>
<p>*<strong>RL</strong></p>
<p>通过强化学习将LLM的输出与人类或猎犬的偏好保持一致是一种潜在的方法。例如，手动注释最终生成的答案，然后通过强化学习提供反馈。除了符合人类偏好之外，还可以符合微调模型和检索器的偏好。</p>
<ul>
<li><em>Distillation</em></li>
</ul>
<p>当情况不允许访问强大的专有模型或更大参数的开源模型时，一个简单而有效的方法是提取更强大的模型（例如GPT-4）。</p>
<ul>
<li><em>Dual FT</em></li>
</ul>
<p>微调生成器和检索器以符合他们的偏好。一种典型的方法，例如<em>RA-DIT</em>，使用 KL 散度来对齐检索器和生成器之间的评分函数。</p>
<h4 id="6-编排">6 编排</h4>
<p>编排是指用于控制 RAG 流程的模块。RAG不再遵循固定的流程，而是在关键点做出决策，并根据结果动态选择下一步。这也是模块化 RAG 相比 Naive RAG 的关键特性之一。</p>
<h4 id="调度">调度</h4>
<p>Judge模块评估RAG过程中的关键点，确定是否需要检索外部文档存储库、答案的满意度以及进一步探索的必要性。它通常用于递归、迭代和自适应检索。具体来说，主要包括以下两个运算符：</p>
<ul>
<li><em>Rule-base</em></li>
</ul>
<p>下一步行动是根据预定义的规则确定的。通常，会对生成的答案进行评分，然后根据分数是否满足预定义阈值来决定继续或停止。常见阈值包括令牌的置信水平。</p>
<ul>
<li><em>Prompt-base</em></li>
</ul>
<p>LLM 自主决定下一步行动。主要有两种方法可以实现这一目标。第一个涉及提示LLM根据对话历史进行反思或做出判断，如 ReACT 框架中所示。这样做的好处是无需微调模型。然而，判决的输出格式取决于LLM对指示的遵守情况。提示基本情况是FLARE。</p>
<ul>
<li><em>Tuning-base</em></li>
</ul>
<p>第二种方法需要 LLM 生成特定的令牌来触发特定的操作，这种方法可以追溯到 Toolformer 并应用于 RAG 中，例如Self-RAG中。</p>
<h4 id="fusion">Fusion</h4>
<h4 id="heading-8"></h4>
<p>这个概念源自RAG Fusion。正如前面关于<em>查询扩展</em>的部分提到的，当前的 RAG 进程不再是单一的管道。它通常需要通过多个分支来扩展检索范围或多样性。因此，在扩展到多个分支后，需要依靠Fusion模块来合并多个答案。</p>
<ul>
<li><em>Possibility Ensemble</em></li>
</ul>
<p>融合方法是根据多个分支生成的不同token的权重值，综合选择最终的输出。主要采用加权平均。请参阅重新插入。</p>
<p>*<strong>RRF（倒数秩融合）</strong></p>
<p>RRF，是一种将多个搜索结果列表的排名组合起来生成单个统一排名的技术。RRF 与滑铁卢大学 (CAN) 和 Google 合作开发，产生的结果比在任何单个分支下重新排序块更有效。</p>
<p><strong>结论</strong></p>
<p>RAG Flow 即将发布的内容将在 PART II 中介绍，即将发布。</p>
<p>由于这是我第一次在 Medium 上发表文章，所以我仍在熟悉许多功能。欢迎任何反馈和批评。</p>
<p>更多AI工具，参考<a href="https://aibard123.com/">Github-AiBard123</a>，<a href="https://aibard123.com/">国内AiBard123</a></p>



          </div>

可关注我们的公众号：每天AI新工具

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


