

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>大模型RAG中embedding的两个新进展BGE-M3及MRL：兼看几个有趣的综述及水印工作 作者： 老刘说NLP 来源： 老刘说NLP 今天是2024年1月31日，星期一，北京，天气晴。 转眼间，2024年已经过去1/12，进度8.4931%，真快。 我们继续看看有趣的话题。 我们在之前的文章中有说到当前RAG-embedding上的一些优化工  | AiBard123| ai工具网址导航,ai最新产品</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AI聊天,AI文本生成,AI绘画,AI编程,AI电商" />
    <meta name="description" content="AiBard123 网址导航 | 免费chatgpt 汇集各类先进的人工智能产品，旨在帮助用户更快速地了解和使用这些产品,轻松地浏览不同领域的AI产品，包括语音识别、图像处理、自然语言处理。" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://aibard123.com/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                        <a href="https://aibard123.com/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>本月热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>热门网站</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>国内热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>对话工具</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>写作</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像处理</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音视频</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音乐生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>办公</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>提示词</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>编程</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AI搜索</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>文本翻译</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>学习网站</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>友情链接</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI 文摘
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">大模型RAG中embedding的两个新进展BGE-M3及MRL：兼看几个有趣的综述及水印工作</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://aibard123.com/about>AiBard123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              January 31, 2024 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cahnsqM4a8V5WEOFCGDtmfP5EyBia1ekA7LFoTTia6eWWLky1qZ9xpnYQ/640?wx_fmt=png&amp;from=appmsg" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <p>作者： 老刘说NLP  来源： <a href="https://mp.weixin.qq.com/s/NJNnyfNaeVNjO1GnJ46T1g">老刘说NLP</a></p>
<p>今天是2024年1月31日，星期一，北京，天气晴。</p>
<p>转眼间，2024年已经过去1/12，进度8.4931%，真快。</p>
<p>我们继续看看有趣的话题。</p>
<p>我们在之前的文章中有说到当前RAG-embedding上的一些优化工作，比如加入rerank模型，引入任务指令的embedding等，最近这块也出了两个新的工作，一个是怎么将embedding变长、混合建模，另一个是怎么将embedding弄短，本文将先介绍这个工作。</p>
<p>另外，最近也在读一些工作，这些工作包括文本水印、数据增强以及长文本，很有趣，分享出来，供大家一起参考。</p>
<h4 id="一rag中embedding进展变长变混合">一、RAG中embedding进展：变长、变混合</h4>
<p>当前，RAG的Embedding嵌入已经陆续发布了许多，例如：</p>
<p>m3e：https://huggingface.co/moka-ai/m3e-base，这个取名很有意思，M3E是Moka Massive Mixed Embedding的缩写：</p>
<p>Moka，表示模型由MokaAI训练，开源和评测，训练脚本使用uniem ，评测BenchMark使用 MTEB-zh；</p>
<p>Massive，表示此模型通过千万级 (2200w+) 的中文句对数据集进行训练</p>
<p>Mixed，表示此模型支持中英双语的同质文本相似度计算，异质文本检索等功能，未来还会支持代码检索。</p>
<p>Embedding，此模型是文本嵌入模型，可以将自然语言转换成稠密的向量</p>
<p>BCE：BCEmbedding: Bilingual and Crosslingual Embedding for RAG，地址：https://github.com/netease-youdao/BCEmbedding/tree/master。</p>
<p>BGE：https://github.com/FlagOpen/FlagEmbedding/。</p>
<p>而最近，Embedding方向也有一定进展，主要有两个方向：</p>
<p><strong>一个是将Embedding的嵌入上下文长度变长</strong> 。</p>
<p>例如，BGE-M3(<a href="https://github.com/FlagOpen/FlagEmbedding/blob/master/FlagEmbedding/BGE_M3/BGE_M3.pdf">https://github.com/FlagOpen/FlagEmbedding/blob/master/FlagEmbedding/BGE_M3/BGE_M3.pdf</a>)，是一个具有多功能、多语言和多粒度特性的文本检索模型。</p>
<p>高效支持多语言（100+语言）、长文本（至多8192长度的输入文本）、和混合检索（稠密、稀疏、多向量）。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cCfK9ctXibhoj3butKeVzINXFKTibF9uFtH0sHBoK1VrV7LUZS0p3m0Bw/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p><strong>1、关于混合搜索</strong></p>
<p>这里的混合检索在于，M3-Embedding统一了嵌入模型的所有三种常见检索功能，即稠密检索、词性（稀疏）检索和多向量检索。</p>
<p>从形式上看，在给定一个x表示的查询q时，从语料库Dy中检索出以y表示的文档d：dy←fn∗(qx,Dy)。其中：fn∗(-)属于密集检索、稀疏/词汇检索或多维检索中的任何一种函数；y可以是另一种语言，也可以是与x相同的语言。</p>
<p>具体的：</p>
<p><strong>sdense，在密集检索上，根据文本编码器将输入查询q转换成隐藏状态Hq，使用特殊标记&quot;[CLS]&ldquo;的归一化隐藏状态来表示查询：eq=norm(Hq[0])，使用ep=norm(Hp[0])来表示段落p的嵌入。</strong></p>
<p>查询和段落之间的相关性得分是通过两个嵌入式eq和ep之间的内积来衡量：sdense←⟨ep,eq⟩。</p>
<p><strong>slex，在词汇检索上，输出嵌入式也用于估算每个词条的重要性。词的重要程度，以方便词汇检索。</strong>  对于查询中的每个术语t（一个术语对应一个token），术语权重的计算公式为如下：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cdVkC1PnAHPMzSkRFmO14aTibHyaZlZ7CCnhaIoFQw508KxNZN8GD4vw/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>如果一个术语t在查询中出现多次，只保留其最大权重，用同样的方法计算段落中每个术语的权重。在估算术语权重的基础上，查询和段落之间的相关性得分由查询和段落中<strong>共存术语（表示为q∩p，也就是交集）的联合重要性计算得出</strong> ：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cicTDQWQIyVLuibrIbkBJrcGN9KCk5C63gtgKu1cqBA3WkLSD7JibbMcYw/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p><strong>smul，在多向量检索上，作为密集检索的扩展，利用整个输出嵌入来表示查询/和段落，并根据Col-Bert使用后期交互来计算细粒度相关性得分。</strong></p>
<p>最后，由于嵌入模型的多功能性，检索过程可以采用混合过程。首先，候选结果可以由每种方法单独检索（多向量方法由于成本高，可以免去这一步骤）。然后，根据综合相关性得分对最终检索结果重新排序：<strong>srank←sdense+slex+smul</strong> 。</p>
<p><strong>2、关于训练数据</strong></p>
<p>我们可以尤其关注下训练数据：</p>
<p>在训练数据上，包括弱监督数据以及微调数据。</p>
<p>其中：<strong>弱监督数据来自无标签语料库，微调数据来自有标签语料库，而微调数据则通过合成来实现，三种数据源互为补充，分别应用于训练过程的不同阶段。</strong></p>
<p>进一步的：</p>
<p><strong>弱监督数据是通过提取维基百科、S2ORC、xP3、mC4和CC-News等各种多语言语料库中的丰富语义结构（如标题-正文、标题-摘要、指令-输出等）来进行整理</strong> 。</p>
<p><strong>为了学习用于跨语言语义匹配的统一嵌入空间，我们从两个翻译数据集MTP、NLLB中进行处理，总共收集了194种语言的12亿个文本对和2655个跨语言对应。</strong></p>
<p>在微调数据方面。对于英语，包括八个数据集，包括HotpotQA、TriviaQA、NQ、MSMARCO、COLIEE、PubMedQA以及SimCSE收集的NLI数据。</p>
<p>对于中文，包括七个数据集，包括DuReader、mMARCO-ZH、T2-Ranking、LawGPT1、CmedQAv2和LeCaRDv2</p>
<p>对于其他语言，利用来自MIRACL的训练数据。</p>
<p>另外，为了缓解长文档检索任务的性能，通过生成合成数据方式进行处理，并引入额外的多语言微调数据（记为MultiLongDoc）。</p>
<p>这里的实现流程也很有趣，<strong>从Wiki和MC4数据集中抽取长篇文章，并从中随机选择段落。然后，使用GPT-3.5根据这些段落生成问题，生成的问题和抽样文章构成微调数据的新文本对。</strong>  又是一个常规的GPT4数据蒸馏操作。</p>
<p>这里采用的prompt为：</p>
<p>“You are a curious AI assistant, please generate one specific and valuable question based on the following text. The generated question should revolve around the core content of this text, and avoid using pronouns (e.g., ”this”). Note that you should generate only one question, without including additional content:”
最终得到的数据分布如下：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1ckHKJPs7zqKMqW4zmEukx2EEg3oWZ5G4s8uBhfibdEchiaEiaP5keVuPnQ/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p><strong>3、关于模型训练</strong></p>
<p>在训练方式上，跟之前的类似，最小化In-foNCE损失进行处理，损失函数如下：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1c60d6jQujicgNqXtz9QlDcS8Oiba2zKzpJykmRRFwqW56FjZDIBzfW2ag/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>其中，p∗ 和P′分别代表查询q的正样本和负样本；s(-)是{sdense(-)、slex(-)、smul(-)} 中的任意一个函数，不过，不同检索方法的预测结果可以整合为一个更准确的相关性得分，因为它们具有异质性。在最简单的形式中，整合可以是不同预测得分的总和： sinter ←sdense+slex+smul。</p>
<p>在知识蒸馏阶段，<strong>以sinter为教师模型监督信号，其中的任何一个得分作为学生模型。</strong></p>
<p>将每种检索方法的损失函数修改为：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1ccib68Y43xkvQ1XZicQ6BY36gC8cO0nUc0eIrBjTWyTB6CF8p6fgVGspw/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>进一步对修正后的损失函数进行积分和归一化处理：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cahnsqM4a8V5WEOFCGDtmfP5EyBia1ekA7LFoTTia6eWWLky1qZ9xpnYQ/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>最后使用线性组合推导出自我知识蒸馏的最终损失函数。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1c3wbH3qSJAog7c2ZCSMtfuUibNAqiahFlqXXSicXFyOmLia0pScPFGvjZWg/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>整个训练过程是一个多阶段的工作流程，如下所示：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1ciawOCfBqbM9dQRExxgTlyItm4HELaB2rezhGponQbrewl6aPEZoBexg/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>首先，使用弱监督数据对文本编码器进行预训练，其中只有密集检索是以对比学习的基本形式进行训练的。<strong>自我知识蒸馏应用于第二阶段，在此阶段对嵌入模型进行微调，以建立三种检索功能。在这一阶段中，将使用标注数据和合成数据，并根据ANCE方法为每个查询引入硬负样本。</strong></p>
<h4 id="二rag中embedding进展缩短嵌入降成本">二、RAG中embedding进展：缩短嵌入降成本</h4>
<p>Embedding嵌入优化的另一方向是把模型的维度打小，也就是缩短嵌入。</p>
<p>OpenAI最近推了两个文本嵌入模型，分别是更小且高效的text-embedding-3-small模型和更大且更强大的text-embedding-3-large模型。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cILYxANxyfzibiamjaSyaicibffyosWLEjg79SgS4rEXwqQCiboCVPSWGS8w/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>比较有意思的是，<strong>当使用仅支持最高1024维嵌入的向量数据存储时，可以使用最好的嵌入模型text-embedding-3-large并指定dimensionsAPI参数的值为1024，使得嵌入维数从3072开始缩短，牺牲一些准确度以换取更小的向量大小</strong> 。</p>
<p>这有点像我们在前面所说的，长文本里线性内插和动态非线形插值NTK式的映射原理。</p>
<p>而再往前回溯，其实际上是一种降维的过程，<strong>我们可以使用PCA进行降到特定的维度。</strong></p>
<p>关于这块，实现思路可以看《<strong>Matryoshka Representation Learning》</strong> (地址https://arxiv.org/pdf/2205.13147.pdf)，实现的官方代码在：https://github.com/RAIVNLab/MRL。</p>
<p>不同于常规的fix的embedding表征，Matryoshka representation learning提出了一个方法，<strong>生成的表征是按照x下标进行重要性排序的，所以在资源受限的环境，可以只使用前面top-k维表征就可以</strong> 。</p>
<p>如下所示，对于d∈N，考虑一组表示尺寸M⊂[d]。对于输入数据X中的数据点x，其的目标是学习一个d维表示向量z∈Rd，对于每一个m∈M、MRL目标是让前m维的表征向量z1:m∈Rm独立地成为可转移的通用表征向量。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cc12NUZcicnSjVrpMDSp42afPiaG5xFBZAWbhk4ZJAZRkea4tbklONy8g/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>Matryoshka(简称MRL)表征学习将典型设置修改为同一任务的多尺度表征学习问题。</p>
<p>例如，在ImageNet-1K上训练ResNet50，将224×224像素的图像嵌入d=2048表示向量，然后通过线性分类器在L=1000个标签中进行预测yˆ。</p>
<p>对于MRL，选择M={8,16,.,1024,2048}作为嵌套维度，假设得到了一个带标签的数据集D={(x1,y1),&hellip;,(xN,yN)}其中xi∈X是输入点，yi∈[L]是所有i∈[N]中xi的标签。</p>
<p>MRL采用标准的经验风险最小化方法，使用单独的线性分类器优化每个嵌套维度m∈M的多类分类损失，参数为W(m)∈RL×m。</p>
<p>所有损失分别按其相对重要性（cm≥0）m∈M缩放后汇总，尽管只对O(log(d))嵌套维度进行优化，MRL仍能产生精确的表示，并对介于所选表示粒度之间的维度进行插值。</p>
<h4 id="三最近的一些有趣的进展">三、最近的一些有趣的进展</h4>
<p>最近也在读一些工作，这些工作包括文本水印、数据增强以及长文本，很有趣，分享出来，供大家一起参考。</p>
<p><strong>1、text_blind_watermark文本水印小工具</strong></p>
<p>把隐秘消息嵌入到另一段文本中，这在文本版权保护上有很大的应用 空间，最近看到一个很有趣的项目text_blind_watermark，文本隐水印/盲水印，把信息隐匿到文本中。</p>
<p>具体理解起来，就是把一段信息嵌入到一段明文中，使信息隐密不可见，并且旁人无法察觉到嵌入后明文的变化。</p>
<p>使用案例：</p>
<pre><code>&gt;&gt; from text_blind_watermark import TextBlindWatermark2  
&gt;&gt;&gt; password = '12345678'  
&gt;&gt;&gt; text = '这句话中有盲水印，你能提取出来吗？'  
&gt;&gt;&gt; watermark = '欢迎关注老刘说nlp'  
&gt;&gt;&gt; text_blind_wm = TextBlindWatermark2(password=password, chr_type=(3, 4))  
&gt;&gt;&gt; text_with_wm = text_blind_wm.embed(text=text, watermark=watermark)  
&gt;&gt;&gt; print(text_with_wm)  
这句话中有盲‌‌‍‌‌‍‍‌‌‍‌‍‍‍‍‌‍‍‌‍‌‍‍‌‍‍‍‍‍‌‌‍‌‍‌‍‍‍‍‍‌‌‌‍‌‌‍‌‌‍‍‌‌‌‍‍‌‍‌‍‌‌‌‌‌‌‍‌‍‍‍‌‌‍‌‍‍‍‌‌‍‍‍‍‍‌‍‌‍‍‍‍‌‍‌‍‌‌‍‌‍‌‌‌‌‍‍‌‌‍‌‌‍‌‍‍‌‌‍‌‌‌‌‍‍‌‍‌‌‌‌‍‌‍‍‍‍‌‍‌‍‌‌‍‌‍‌‍‌‍‌‍‍‍‍‌‌‍‍‌‍‍‍‌‍‌‍‌‌‌‍‌‍‌‌‌‍‍‍‍‍‌‍‍‍‍‌‌‌‍‍‍水印，你能提取出来吗？  
&gt;&gt;&gt; text_blind_wm2 = TextBlindWatermark2(password=password, chr_type=(3, 4))  
&gt;&gt;&gt; wm_extract = text_blind_wm2.extract(text_with_wm)  
&gt;&gt;&gt; print('提取内容：', wm_extract)  
提取内容： 欢迎关注老刘说nlp  
</code></pre>
<p>地址：github.com/guofei9987/text_blind_watermark，</p>
<p><strong>2、关于长文本的一个经典综述</strong></p>
<p>我们在刚结束的社区分享中有介绍到长文本，其中涉及到长文本中的一些基本问题，具体的，可以参考大模型中上下文长度扩展技术的本质、动因的一个综述：<strong>《The What, Why, and How of Context Length Extension Techniques in Large Language Models &ndash; A Detailed Survey》</strong> ：https://arxiv.org/pdf/2401.07872</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1cy4MAz3Fmhub8pHRsx1FcO757QfaB2WicWBYDnmFr6tSM1RqQ1icWmZuA/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<p>此外也有一些博客写的很好，可以看看https://zhuanlan.zhihu.com/p/660073229。</p>
<p><strong>3、关于大模型数据增强的一个经典综述</strong></p>
<p>数据增强，现在叫合成数据，是当前大模型领域的重要话题，关于这块，可以看看最近的工作《A Survey on Data Augmentation in Large Model Era》(<a href="https://arxiv.org/pdf/2401.15422">https://arxiv.org/pdf/2401.15422</a>)，对应的详细suervey列表放在：https://github.com/MLGroup-JLU/LLM-data-aug-survey</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/fUBU1yiaEmJjXtLiapickvnzkrDeTrKFO1ciaRhc6qChE0ATH9vOnTo4J8hv658GAUHtxPicblibbCia1oR8K7zcvl3yQ/640?wx_fmt=png&amp;from=appmsg" alt=""></p>
<h4 id="总结">总结</h4>
<p>本文主要介绍了当前RAG-embedding上的一些进展，一个是怎么将embeddin变长、混合建模，另一个是怎么将embedding弄短，其中一些数据、算法模型细节可以进一步看看，尤其是关注数据。</p>
<p>此外，第二部分提到的综述也十分值得一读，大家可以结合社区的第二讲分享一起看看，会有更多守候。</p>
<h4 id="参考文献">参考文献</h4>
<p>1、https://github.com/FlagOpen/FlagEmbedding/blob/master/FlagEmbedding/BGE_M3/BGE_M3.pdf)</p>
<h4 id="关于我们">关于我们</h4>
<p>老刘，刘焕勇，NLP开源爱好者与践行者，主页：https://liuhuanyong.github.io。</p>
<p>老刘说NLP，将定期发布语言资源、工程实践、技术总结等内容，欢迎关注。</p>
<p><strong>对于想加入更优质的知识图谱、事件图谱、大模型AIGC实践、相关分享的，可关注公众号，在后台菜单栏中点击会员社区-&gt;会员入群加入。</strong></p>
<p>更多AI工具，参考<a href="https://aibard123.com/">Github-AiBard123</a>，<a href="https://aibard123.com/">国内AiBard123</a></p>



          </div>

可关注我们的公众号：每天AI新工具

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


