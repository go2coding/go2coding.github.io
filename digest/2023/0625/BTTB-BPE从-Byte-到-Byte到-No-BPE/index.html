

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>[BTTB] BPE：从 Byte 到 Byte，到 No BPE 作者： AINLP 来源： [AINLP](https://mp.weixin.qq.com/s/AnZQII7ACp-ACtuFHaGNVg) 考古文，最新东西卷不过几个大号，而且本人也比较喜欢在小小的角落，挖呀挖呀挖~ 因为早期搞 NMT（机器翻译），所以 BPE 挺早就知道了，但也没太深究名字。最近突然想起挖了挖，原来还有这样一段故事，颇为有趣，给大家增加点冷知识作为谈资，  | AiBard123| ai工具网址导航,ai最新产品</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AI聊天,AI文本生成,AI绘画,AI编程,AI电商" />
    <meta name="description" content="AiBard123 网址导航 | 免费chatgpt 汇集各类先进的人工智能产品，旨在帮助用户更快速地了解和使用这些产品,轻松地浏览不同领域的AI产品，包括语音识别、图像处理、自然语言处理。" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://aibard123.com/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                        <a href="https://aibard123.com/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>本月热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>热门网站</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>国内热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>对话工具</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>写作</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像处理</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音视频</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音乐生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>办公</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>提示词</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>编程</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AI搜索</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>文本翻译</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>学习网站</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>友情链接</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI 文摘
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">[BTTB] BPE：从 Byte 到 Byte，到 No BPE</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://aibard123.com/about>AiBard123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              June 25, 2023 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSJuK8UUBxdZXj1c20hUg374YPgXibgDGytAy87YxvVk4WCRFWrdKJPshStrlPJp4vGEGUQodxt7ibOw/640?wx_fmt=jpeg" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <pre><code>作者： AINLP  来源： [AINLP](https://mp.weixin.qq.com/s/AnZQII7ACp-ACtuFHaGNVg)
</code></pre>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSJuK8UUBxdZXj1c20hUg374YPgXibgDGytAy87YxvVk4WCRFWrdKJPshStrlPJp4vGEGUQodxt7ibOw/640?wx_fmt=jpeg" alt=""></p>
<p>考古文，最新东西卷不过几个大号，而且本人也比较喜欢在小小的角落，挖呀挖呀挖~</p>
<p>因为早期搞 NMT（机器翻译），所以 BPE 挺早就知道了，但也没太深究名字。最近突然想起挖了挖，原来还有这样一段故事，颇为有趣，给大家增加点冷知识作为谈资，也分享一些自己见解。</p>
<h4 id="byte-begins">Byte Begins</h4>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/Gyc8xouDEr1MdibJpKcyIuMRWdsdRfnRJaYOTSl80liaoQSfpgGnfuVpFvJ8KkMNzvTicejtgg6NY9pPjlMJ5rJbQ/640?wx_fmt=other" alt=""></p>
<p>虽然该算法现在是以 Tokenizer 被大家知道，但从一个 Tokenizer 的角度来看名字却很奇怪：<strong>Byte Pair Encoding（BPE）</strong> ，不太像是一个 Tokenizer 的名字。横向对比来看，其他常用 subword Tokenizer 都叫：Unigram、WordPiece，一看就和语言相关，突然就蹦出来一个 BPE。</p>
<p>硕士做机器翻译相关，开始还挺疑惑，翻 Sennrich 那篇论文才知道最早是压缩算法，借鉴过来用于 Tokenizer，所以名字也没改，当时也没深究了，忙着玩呢。</p>
<p>最近给提出 BPE 那篇 <em>A New Algorithm for Data Compression</em> 给看了，还是有收获的，角度不同。</p>
<p>首先，自然生成数据大都有规律可循，所以大多压缩算法 idea 就是给常见模式用更短表征来替换，就是贪心算法。BPE 也基于相同思想：<strong>找到相邻最高频的 byte 对，然后用另外一个没用过的 byte 来替换</strong> 。</p>
<p>论文中原话是：</p>
<blockquote>
<p>The algorithm compresses data by finding the most frequently occurring pairs of adjacent bytes in the data and replacing all instances of the pair with a byte that was not in the original data. The algorithm repeats this process until no further compression is possible, either because there are no more frequently occurring pairs or there are no more unused bytes to represent pairs. The algorithm writes out the table of pair substitutions before the packed data.</p>
<p>算法压缩数据时，会先<strong>找到数据中最常出现的相邻 byte 对</strong> ，然后<strong>将这个 byte 对用没出现过在原数据中的 byte 来表示</strong> 。该算法<strong>不断重复此过程，直到不能进一步压缩</strong> ，比如说没有更多高频 byte 对，或是没有没用过的 byte 来进行替换表示了。最后算法会在写出压缩数据前，写出替换 byte 对的替换表。</p>
</blockquote>
<p>熟悉 BPE Tokenizer 训练流程的同学，应该会感觉到有那味儿了。</p>
<p>现在再看 Byte Pair Encoding 这个名字，毫无违和感。至于为什么用 byte，因为作为一个 lossless 的通用压缩算法，自然要用 byte 这个通用最小表示单元，为什么不用 bit 呢，嗯，总共才两位。</p>
<p>此时的 BPE 算法具体过程是，将需压缩文件转成 Byte 流，将一部分存入 buffer，接着对这部分进行 BPE 算法压缩，不断找高频 byte pair 用没用上的 byte 替换掉。最后<strong>输出压缩过的文件</strong> ，还有一个<strong>有序的替换表</strong> 用于还原。因为会按 buffer 大小切成很多部分，所以输入一个文件，获得很多段被压缩的byte段，以及每段对应的替换表。</p>
<blockquote>
<p>输入：文件</p>
<p>输出：多个压缩文件段 + 多个替换查询表</p>
</blockquote>
<p>解压时，只需要对每段用替换表，反向替换一遍就能获得原始文件。</p>
<h4 id="bye-bye-byte">Bye Bye~ Byte</h4>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/Gyc8xouDEr1MdibJpKcyIuMRWdsdRfnRJHofsVFicvha1QuXI9m0k8DhtSSZAu15BOoxKEwibmMwS1v7qnOPC5WuA/640?wx_fmt=png" alt=""></p>
<p>然而作为压缩算法而提出的 BPE，可能因为在压缩速度和压缩率上并没啥优势，所以也没在压缩领域获得太大关注。看早期引用它的论文，也大多是模式匹配还有手机终端通讯的少量文章。直到 Sennrich 那篇给 BPE 算法用在 Tokenizer 训练，才开始逐渐受到关注。</p>
<p>这就来到了 Sennrich 15 年那篇 <em>Neural Machine Translation of Rare Words with Subword Units</em>，给 BPE 引入 NLP 领域。</p>
<p>思想是类似的，也就是找到最高频相邻 pair，然后替换掉。不同之处在于：</p>
<ol>
<li>
<p>不再是对 byte 维度进行操作了，而是在 character 层面上进行操作；</p>
</li>
<li>
<p>原算法只能在已有 byte 个数上进行 merge 替换，比如一个终止条件就是未使用 byte 没了，但 BPE Tokenizer 算法，则只需要给新 merge 出来的片段一个新 词表 id，就可以无限扩充。</p>
</li>
</ol>
<p>于是 BPE 就完成了一次从 Byte 到 Character 的跳跃，算法名字中的 Byte 也就失去了意义，更多变成了指融合相邻 pair，不断替换成新词的 Tokenizer 算法。</p>
<p>因为 Subword Tokenizer 能比较有效解决 OOV 问题，而且效果也还不错，所以也就从机器翻译慢慢推广开了。但到 BERT 时期最流行的也都还是 WordPiece，因为 Bert 用 WordPiece. 所以直到 GPT2 随着 GPT 受到关注，BPE 也就获得更多关注。</p>
<p>Sennrich 这一步是最有开创性的一步，<strong>给一个其他领域算法用在一个全新领域</strong> ，而且<strong>赋予新的意义</strong> ，包括<strong>用法上的思路也不一样了</strong> 。</p>
<p>BPE 算法过程变成了，先拿到训练数据集（也可采样部分），做一些前处理，切分，拆成英文 char 级别，接着统计相邻 char 频率，将最高频的用 merge 后 pair 替换掉，同时词表加一.</p>
<p>下面是原论文中实现：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/Gyc8xouDEr1MdibJpKcyIuMRWdsdRfnRJvqXNOGQj4AT9Y8XqcCIbxGx12abu53j4mGyFYFUiazj5McfVvmrlgSg/640?wx_fmt=png" alt=""></p>
<p>和 BPE 压缩算法的不同在于，输入训练文本文件，没 buffer 切分，在整个文件层面上进行 char 级别 pair 统计，不断将最高频 pair 合并起来，重新统计，合并。直到满足设一个合并次数限制，或其他限制（如频率都低于某个阈值）。整个过程记录不断加入的新词，即<strong>词表文件</strong> （vocab.json），而记录下来的 merge 操作，就是 <strong>merge 文件</strong> （merge.txt）。</p>
<blockquote>
<p>输入：训练文本</p>
<p>输出：词表文件 + merge 文件</p>
</blockquote>
<p>之后使用时，用词表文件+merge文件将输入的文本转成对应 id，从压缩算法角度来看，可以理解为每次都对输入文本进行压缩，而模型在压缩后的文本上进行训练。</p>
<p>为什么要压缩，而不在原始文件 char 级别，或词级别直接训呢。</p>
<p>这就涉及到效率的权衡，直接词级别，各种各样词太多了，词表会特别大，稀疏，要对词表中每个 id 都进行充分训练，训练效率不高，而如果限制词表大小，还会出现很多 OOV（Out-of-Vocabulary，词表中没有的词）；而如果是 char 级别，又会出现每个输入特别长，这个也带来效率问题，如果是 LSTM 的话 timestep 会特别长，训练费时，还要担心梯度传播问题，如果是 Transformer 又因为计算复杂度  的问题，效率也不高。</p>
<p>所以 BPE 子词 Tokenizer 算法，只是效率上权衡下采用的一种 Tokenizer 算法。</p>
<p>到这一步 Byte Pair Encoding 里的 Byte 已失去了意义，主要是 Pair Encoding，大家说 BPE 也都指这个意思。</p>
<h4 id="back-to-the-byte-bttb">Back to the Byte (BTTB)</h4>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/Gyc8xouDEr1MdibJpKcyIuMRWdsdRfnRJyibjfm7BOcwm3Ug5WgWyajoic5Bpvibiavd5niaUiadpY49L01nU5AcXdkHg/640?wx_fmt=png" alt=""></p>
<p>最开始看到 ByteLevelBPE 思路时，还挺疑惑，为什么要这么做，也没觉得 ByteLevelBPE 有多好，反而因为和大多 Bert 类（除 Roberta） Tokenizer 相差较大，中间 byte 组成的 token，可解释性也不太好，而且当时在 benchmark 上也没体现太多优势。</p>
<p>一些早期看不懂东西，可能和传统做法不同，且刚开始效果一般，导致大家也都没在意。直到各种条件满足了，如硬件调节，接着突然拿到一个很好效果，说服了大家，然后整个范式就从旧的换到新的范式上来。</p>
<p>chatGPT 的技术22年年初就基本都告诉大家了，GPT3 也很久前东西，RLHF 这个 OpenAI 也搞挺久了，再久远 Deep Learning 又何尝不是。</p>
<p>言归正传，ByteLevelBPE 思路，就是给之前 BPE 的 char 思路推回 byte，ByteLevelBPE 则是先给所有 char 都先转成 byte，接着在 byte 级别上训练词表。</p>
<p>比 char 的优势体现在什么地方，下面几点：</p>
<ol>
<li>
<p><strong>OOV 问题基本上不存在了</strong> ，之前的 NLP 在词表这块一直存在一个 OOV 问题（所以会有个类似 [UNK] 的token）；</p>
</li>
<li>
<p>也和 OOV 问题相关，之前主要做英文相关 NLP，而一旦做<strong>多语言</strong> 用英文词表就全是 OOV，而到 Byte 级别就能处理所有字符，颜文字都能处理；</p>
</li>
<li>
<p>Byte级别，就<strong>不需要管一些前处理步骤</strong> 了，比如 lower case 啥的，直接输入转 byte，然后直接输出 byte，再转成 unicode 文本</p>
</li>
</ol>
<p>有意思的是，明明 BPE 里已经有 byte 这个词，但因为大家之前都基本给 BPE 当成 PE（Pair Encoding）来用了，为强调 byte 这一点，又刻意再加上 ByteLevel 来说明，于是<strong>从 byte 出发，到跟 byte 没关系，结果又回到 byte</strong> .</p>
<p>随着不断 Scaling，加上处理多语言， ByteLevelBPE 已经成为默认 Tokenizer 算法了，无论是效率还是使用方面。</p>
<p>ByteLevelBPE 训练和 BPE 算法一样，输入训练文本，获得词表文件和 merge 文件。但这块 OpenAI 的 tiktoken 库较新词表都只有一个文件了，开始还以为搞出了什么新技术，后来发现就是 merge 词表。想了一下确实，因为 <strong>vocab 是隐含在 merge 中的</strong> ，本质上只用 merge 就可以。</p>
<blockquote>
<p>输入：训练文本</p>
<p>输出：byte 级别的 merge 表</p>
</blockquote>
<h4 id="未来no-bpe">未来：No BPE</h4>
<p>现在再看训 ByteLevelBPE Tokenizer 到模型训练，本质上就是先在训练语料上进行 BPE 训练统计，获得一个压缩词表，训练时先对训练数据进行转换，转成对应的 id，这一步相当于一个压缩过程，之后语言模型再在压缩数据上进行训练。</p>
<p>从压缩角度来看，压缩相关之前张俊林有篇《世界的参数倒影》，我自己很久之前（你有几篇不是很久之前？）也写过篇相关《<a href="https://mp.weixin.qq.com/s?__biz=MzUxMjE1NzA2MA==&amp;mid=2247484283&amp;idx=1&amp;sn=48fe5e71116cccb18d2b1383f7b56c4e&amp;scene=21#wechat_redirect">信息论，语言模型，压缩闲谈</a>》，相当于我们先对整个训练数据进行压缩，然后通过训练模型，进行进一步压缩学习。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/Gyc8xouDEr1MdibJpKcyIuMRWdsdRfnRJv2pegkW3QUlcHRom085ZXCkSFwoHfzEp5fJafwaJDqeHzGicyia6xIdQ/640?wx_fmt=jpeg" alt=""></p>
<p>我一直是大力出奇迹的推崇者，相信之后走向如《<a href="https://mp.weixin.qq.com/s?__biz=MzUxMjE1NzA2MA==&amp;mid=2247484005&amp;idx=1&amp;sn=b9e6196d9c6dc169473ab7d2b3f341ad&amp;scene=21#wechat_redirect">苦痛的教训</a>》中说的，随着算力成本越来越低，那么肯定会干掉所有辅助先验。现在基本已经干掉了语言学先验，一些中间任务。那在 BPE 算法角度，能看到现在还相当于 <strong>BPE 先验压缩一遍</strong> ，然后<strong>模型训练再压缩一遍</strong> 的做法，那干掉步骤，就应该干掉 BPE，也就是 <strong>No BPE 直接在最基础单元上进行训练</strong> 。</p>
<p>什么是最基础单元，比如byte、像素等等，这些也有些相关论文。但这些算法现在还处在一个早期没明显优势阶段，其实可以类比成 GPT2 刚放出来，大家也没觉得 ByteLevelBPE 有多好，但是我相信随着算力的进一步发展，同时大家对各种模态输入的需求，这个方向是必然的，到时候也就不需要 BPE 这个中间过程，直接从最原始的输入开始。</p>
<p>而且回归到这种基础单元，有些现在解决不了的问题直接就能解决了，如常举例子，现在 GPT Tokenizer 对于单词 char 级别反转类就不好做，而如果换成更底层单元的话就能直接做了。</p>
<h4 id="reference">Reference</h4>
<ol>
<li>
<p>A New Algorithm for Data Compression</p>
</li>
<li>
<p>Neural Machine Translation of Rare Words with Subword Units</p>
</li>
<li>
<p>Language Models are Unsupervised Multitask Learners</p>
</li>
<li>
<p>MEGABYTE: Predicting Million-byte Sequences with Multiscale Transformers</p>
</li>
</ol>
<pre><code>**进技术交流群请添加AINLP小助手微信（id: ainlp2)**   


**请备注具体方向+所用到的相关技术点** 

![](https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSJADkmZ2IX6Z23znAibuEevotDMq9iaMxiapK7jfMibiauGFkycicAJEs6x5U9SGyDJZ0S1tRed9TPNUUDQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1)



**关于AINLP** 

AINLP 是一个有趣有AI的自然语言处理社区，专注于 AI、NLP、机器学习、深度学习、推荐算法等相关技术的分享，主题包括文本摘要、智能问答、聊天机器人、机器翻译、自动生成、知识图谱、预训练模型、推荐系统、计算广告、招聘信息、求职经验分享等，欢迎关注！加技术交流群请添加AINLP小助手微信(id：ainlp2)，备注工作/研究方向+加群目的。

  


  


![](https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSKABHCqVVQkVYPrM4XY1vsd0iaeuXzyJnoFc8cibd5mYb4wdA3WMQtiaPVmr0XLZHMuVibqWncibpnTSnQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1)

**阅读至此了，分享、点赞、在看三选一吧🙏** 
</code></pre>



          </div>

可关注我们的公众号：每天AI新工具

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


