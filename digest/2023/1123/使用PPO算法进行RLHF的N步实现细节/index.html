

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>ä½¿ç”¨PPOç®—æ³•è¿›è¡ŒRLHFçš„Næ­¥å®ç°ç»†èŠ‚ ä½œè€…ï¼š AINLP æ¥æºï¼š AINLP å½“ä¸‹ï¼ŒRLHF/ChatGPT å·²ç»å˜æˆäº†ä¸€ä¸ªéå¸¸æµè¡Œçš„è¯é¢˜ã€‚æˆ‘ä»¬æ­£åœ¨è‡´åŠ›äºæ›´å¤šæœ‰å…³ RLHF çš„ç ”ç©¶ï¼Œè¿™ç¯‡åšå®¢å°è¯•å¤ç° OpenAI åœ¨ 2019 å¹´å¼€æºçš„åŸå§‹ RLHF ä»£ç åº“ï¼Œå…¶ä»“åº“ä½ç½®ä½äº openai/lm-human-preferencesã€‚å°½ç®¡å®ƒå…·æœ‰ â€œten  | AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AIèŠå¤©,AIæ–‡æœ¬ç”Ÿæˆ,AIç»˜ç”»,AIç¼–ç¨‹,AIç”µå•†" />
    <meta name="description" content="AiBard123 ç½‘å€å¯¼èˆª | å…è´¹chatgpt æ±‡é›†å„ç±»å…ˆè¿›çš„äººå·¥æ™ºèƒ½äº§å“ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·æ›´å¿«é€Ÿåœ°äº†è§£å’Œä½¿ç”¨è¿™äº›äº§å“,è½»æ¾åœ°æµè§ˆä¸åŒé¢†åŸŸçš„AIäº§å“ï¼ŒåŒ…æ‹¬è¯­éŸ³è¯†åˆ«ã€å›¾åƒå¤„ç†ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€‚" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://aibard123.com/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                        </a>
                        <a href="https://aibard123.com/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>æœ¬æœˆçƒ­é—¨</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>çƒ­é—¨ç½‘ç«™</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å›½å†…çƒ­é—¨</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å¯¹è¯å·¥å…·</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å†™ä½œ</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å›¾åƒç”Ÿæˆ</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å›¾åƒå¤„ç†</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>éŸ³è§†é¢‘</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>éŸ³ä¹ç”Ÿæˆ</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>åŠå…¬</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>æç¤ºè¯</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>ç¼–ç¨‹</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AIæœç´¢</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>æ–‡æœ¬ç¿»è¯‘</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>å­¦ä¹ ç½‘ç«™</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>å‹æƒ…é“¾æ¥</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AiBard123| aiå·¥å…·ç½‘å€å¯¼èˆª,aiæœ€æ–°äº§å“">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>é¦–é¡µ</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">ç–å½±æ¨ªæ–œæ°´æ¸…æµ…ï¼Œæš—é¦™æµ®åŠ¨æœˆé»„æ˜ã€‚</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI æ–‡æ‘˜
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">ä½¿ç”¨PPOç®—æ³•è¿›è¡ŒRLHFçš„Næ­¥å®ç°ç»†èŠ‚</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://aibard123.com/about>AiBard123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              November 23, 2023 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVVFPwx4huBs6CINGIgGWLk6nM4uCaPJtvvjJA8QxlvG8Kykia8ickrGwQ/640?wx_fmt=png" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <p>ä½œè€…ï¼š AINLP  æ¥æºï¼š <a href="https://mp.weixin.qq.com/s/sM4YFA_SrqJXZ4JhLvG06A">AINLP</a></p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSJuK8UUBxdZXj1c20hUg374YPgXibgDGytAy87YxvVk4WCRFWrdKJPshStrlPJp4vGEGUQodxt7ibOw/640?wx_fmt=jpeg" alt=""></p>
<p>å½“ä¸‹ï¼ŒRLHF/ChatGPT å·²ç»å˜æˆäº†ä¸€ä¸ªéå¸¸æµè¡Œçš„è¯é¢˜ã€‚æˆ‘ä»¬æ­£åœ¨è‡´åŠ›äºæ›´å¤šæœ‰å…³ RLHF çš„ç ”ç©¶ï¼Œè¿™ç¯‡åšå®¢å°è¯•å¤ç° OpenAI åœ¨ 2019 å¹´å¼€æºçš„åŸå§‹ RLHF ä»£ç åº“ï¼Œå…¶ä»“åº“ä½ç½®ä½äº <em>openai/lm-human-preferences</em>ã€‚å°½ç®¡å®ƒå…·æœ‰ â€œtensorflow-1.xâ€ çš„ç‰¹æ€§ï¼Œä½† OpenAI çš„åŸå§‹ä»£ç åº“è¯„ä¼°å’ŒåŸºå‡†æµ‹è¯•éå¸¸å®Œå–„ï¼Œä½¿å…¶æˆä¸ºç ”ç©¶ RLHF å®ç°å·¥ç¨‹ç»†èŠ‚çš„å¥½åœ°æ–¹ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯:</p>
<ol>
<li>
<p>å¤ç° OAI åœ¨é£æ ¼åŒ–ä»»åŠ¡ä¸­çš„ç»“æœï¼Œå¹¶åŒ¹é… <em>openai/lm-human-preferences</em> çš„å­¦ä¹ æ›²çº¿ã€‚</p>
</li>
<li>
<p>æä¾›ä¸€ä¸ªå®ç°ç»†èŠ‚çš„æ¸…å•ï¼Œç±»ä¼¼äº è¿‘ç«¯ä¼˜åŒ–ç­–ç•¥çš„ 37 ä¸ªå®æ–½ç»†èŠ‚ (<em>The 37 Implementation Details of Proximal Policy Optimization</em>) å’Œ æ²¡æœ‰ç—›è‹¦æŠ˜ç£¨çš„è°ƒè¯• RL (<em>Debugging RL, Without the Agonizing Pain</em>) çš„é£æ ¼;</p>
</li>
<li>
<p>æä¾›ä¸€ä¸ªæ˜“äºé˜…è¯»ä¸”ç®€æ´çš„ RLHF å‚è€ƒå®ç°;</p>
</li>
</ol>
<p>è¿™é¡¹å·¥ä½œä»…é€‚ç”¨äºä»¥æ•™è‚²/å­¦ä¹ ä¸ºç›®çš„çš„ã€‚å¯¹äºéœ€è¦æ›´å¤šåŠŸèƒ½çš„é«˜çº§ç”¨æˆ·ï¼Œä¾‹å¦‚ä½¿ç”¨ PEFT è¿è¡Œæ›´å¤§çš„æ¨¡å‹ï¼Œ <em>huggingface/trl</em> å°†æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<ul>
<li>
<p>åœ¨ åŒ¹é…å­¦ä¹ æ›²çº¿ ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬çš„ä¸»è¦è´¡çŒ®: åˆ›å»ºä¸€ä¸ªä»£ç åº“ï¼Œèƒ½å¤Ÿåœ¨é£æ ¼åŒ–ä»»åŠ¡ä¸­å¤ç° OAI çš„ç»“æœï¼Œå¹¶ä¸”ä¸ <em>openai/lm-human-preferences</em> çš„å­¦ä¹ æ›²çº¿éå¸¸æ¥è¿‘åœ°åŒ¹é…ã€‚</p>
</li>
<li>
<p>ç„¶åæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†ä¸å¤ç° OAI çš„å·¥ä½œç›¸å…³çš„å®ç°ç»†èŠ‚ã€‚åœ¨ æ€»ä½“å®ç°ç»†èŠ‚ ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†åŸºæœ¬ç»†èŠ‚ï¼Œåƒå¦‚ä½•ç”Ÿæˆå¥–åŠ±/å€¼å’Œå¦‚ä½•ç”Ÿæˆå“åº”ã€‚åœ¨ å¥–åŠ±æ¨¡å‹å®ç°ç»†èŠ‚ ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†è¯¸å¦‚å¥–åŠ±æ ‡å‡†åŒ–ä¹‹ç±»çš„ç»†èŠ‚ã€‚åœ¨ ç­–ç•¥è®­ç»ƒå®ç°ç»†èŠ‚ ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æ‹’ç»é‡‡æ ·å’Œå¥–åŠ±â€œç™½åŒ–â€ç­‰ç»†èŠ‚ã€‚</p>
<ul>
<li>åœ¨<strong>PyTorch Adam ä¼˜åŒ–å™¨åœ¨å¤„ç† RLHF æ—¶çš„æ•°å€¼é—®é¢˜</strong>  ä¸­ï¼Œæˆ‘ä»¬å¼ºè°ƒäº† TensorFlow å’Œ PyTorch ä¹‹é—´ Adam çš„ä¸€ä¸ªéå¸¸æœ‰è¶£çš„å®ç°åŒºåˆ«ï¼Œå…¶å¯¼è‡´äº†æ¨¡å‹è®­ç»ƒä¸­çš„æ¿€è¿›æ›´æ–°ã€‚</li>
</ul>
</li>
<li>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†åœ¨å¥–åŠ±æ ‡ç­¾ç”± gpt2-large
ç”Ÿæˆçš„æƒ…å†µä¸‹ï¼Œè®­ç»ƒä¸åŒåŸºç¡€æ¨¡å‹ (ä¾‹å¦‚ gpt2-xl, falcon-1b) çš„æ•ˆæœã€‚</p>
</li>
<li>
<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è®¨è®ºä¸€äº›é™åˆ¶æ¥æ€»ç»“æˆ‘ä»¬çš„ç ”ç©¶å·¥ä½œã€‚</p>
</li>
</ul>
<p><strong>ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦é“¾æ¥:</strong></p>
<ul>
<li>
<p>ğŸ’¾ æˆ‘ä»¬çš„å¤ç°ä»£ç åº“ <em><a href="https://github.com/vwxyzjn/lm-human-preference-details">https://github.com/vwxyzjn/lm-human-preference-details</a></em></p>
</li>
<li>
<p>ğŸ¤— RLHF æ¨¡å‹æ¯”è¾ƒç¤ºä¾‹: <em><a href="https://huggingface.co/spaces/lm-human-preference-details/rlhf-demo">https://huggingface.co/spaces/lm-human-preference-details/rlhf-demo</a></em></p>
</li>
<li>
<p>ğŸ æ‰€æœ‰çš„ w&amp;b è®­ç»ƒæ—¥å¿— <em><a href="https://wandb.ai/openrlbenchmark/lm_human_preference_details">https://wandb.ai/openrlbenchmark/lm_human_preference_details</a></em></p>
</li>
</ul>
<h4 id="åŒ¹é…å­¦ä¹ æ›²çº¿">åŒ¹é…å­¦ä¹ æ›²çº¿</h4>
<p>æˆ‘ä»¬çš„ä¸»è¦è´¡çŒ®æ˜¯åœ¨é£æ ¼åŒ–ä»»åŠ¡ä¸­å¤ç° OAI çš„ç»“æœï¼Œä¾‹å¦‚æƒ…æ„Ÿå’Œæè¿°æ€§ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„ä»£ç åº“ (æ©™è‰²æ›²çº¿) èƒ½å¤Ÿäº§ç”Ÿä¸ OAI çš„ä»£ç åº“ (è“è‰²æ›²çº¿) å‡ ä¹ç›¸åŒçš„å­¦ä¹ æ›²çº¿ã€‚</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVHMpQXvtKb43VUyMydFpe6kVPAjgrNR7kGZic8Arc5NShO4aFDbPYHpQ/640?wx_fmt=png" alt=""></p>
<h4 id="å…³äºè¿è¡Œ-openailm-human-preferences-çš„è¯´æ˜">å…³äºè¿è¡Œ openai/lm-human-preferences çš„è¯´æ˜</h4>
<p>ä¸ºäº†ç›´è§‚æ¯”è¾ƒï¼Œæˆ‘ä»¬è¿è¡Œäº†åŸå§‹çš„ RLHF ä»£ç ï¼Œå…¶ä»“åº“ä½ç½®ä½äº <em>openai/lm-human-preferences</em>ï¼Œå®ƒå°†æä¾›å®è´µçš„æŒ‡æ ‡ï¼Œä»¥å¸®åŠ©éªŒè¯å’Œè¯Šæ–­æˆ‘ä»¬çš„å¤ç°ã€‚æˆ‘ä»¬èƒ½å¤Ÿè®¾ç½®åŸå§‹çš„ TensorFlow 1.x ä»£ç ï¼Œä½†å®ƒéœ€è¦ä¸€ä¸ªéå¸¸ç‰¹å®šçš„è®¾ç½®:</p>
<ul>
<li>
<p>OAI çš„æ•°æ®é›†éƒ¨åˆ†æŸå/ä¸¢å¤± (æ‰€ä»¥æˆ‘ä»¬ç”¨ç±»ä¼¼çš„ HF æ•°æ®é›†æ›¿æ¢äº†å®ƒä»¬ï¼Œè¿™å¯èƒ½ä¼šæˆ–å¯èƒ½ä¸ä¼šå¯¼è‡´æ€§èƒ½å·®å¼‚)</p>
<ul>
<li>å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä¹¦ç±æ•°æ®é›†åœ¨ OpenAI çš„ GCP - Azure è¿ç§»è¿‡ç¨‹ä¸­ä¸¢å¤±äº† (<a href="https://github.com/openai/lm-human-preferences/issues/17#issuecomment-1044051496">https://github.com/openai/lm-human-preferences/issues/17#issuecomment-1044051496</a>)ã€‚æˆ‘ç”¨ Hugging Face çš„ bookcorpus
æ•°æ®é›†æ›¿æ¢äº†ä¹¦ç±æ•°æ®é›†ï¼ŒåŸåˆ™ä¸Šï¼Œè¿™æ˜¯ç±»ä¼¼ OAI ä½¿ç”¨çš„æ•°æ®é›†ã€‚</li>
</ul>
</li>
<li>
<p>å®ƒä¸èƒ½åœ¨ 1 ä¸ª V100 ä¸Šè¿è¡Œï¼Œå› ä¸ºå®ƒæ²¡æœ‰å®ç°æ¢¯åº¦ç´¯ç§¯ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªå¤§çš„ BS (æ‰¹é‡å¤§å°)ï¼Œå¹¶åœ¨ 8 ä¸ª GPU ä¸Šåˆ†å‰² batch (æ‰¹é‡)ï¼Œä»…åœ¨ 1 ä¸ª GPU ä¸Šå°±ä¼šå‡ºç° OOM (å†…å­˜æº¢å‡º)ã€‚</p>
</li>
<li>
<p>å®ƒä¸èƒ½åœ¨ 8 ä¸ª A100 ä¸Šè¿è¡Œï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯ TensorFlow 1.xï¼Œä¸ Cuda 8+ ä¸å…¼å®¹ã€‚</p>
</li>
<li>
<p>å®ƒä¸èƒ½åœ¨ 8 ä¸ª V100 (16GB) ä¸Šè¿è¡Œï¼Œå› ä¸ºå®ƒä¼š OOM (å†…å­˜æº¢å‡º)ã€‚</p>
</li>
<li>
<p>å®ƒåªèƒ½åœ¨ 8 ä¸ª V100 (32GB) ä¸Šè¿è¡Œï¼Œè¿™ç§é…ç½®ä»…ç”± AWS ä»¥ p3dn.24xlarge
å®ä¾‹çš„å½¢å¼æä¾›ã€‚</p>
</li>
</ul>
<h4 id="æ€»ä½“å®ç°ç»†èŠ‚">æ€»ä½“å®ç°ç»†èŠ‚</h4>
<p>æˆ‘ä»¬ç°åœ¨æ·±å…¥æ¢è®¨ä¸å¤ç° OAI å·¥ä½œç›¸å…³çš„æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚åœ¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€äº›åŸºæœ¬ç»†èŠ‚ï¼Œä¾‹å¦‚å¥–åŠ±/å€¼æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œä»¥åŠå“åº”æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç»†èŠ‚ï¼Œä¸æŒ‰ç‰¹å®šé¡ºåºåˆ—å‡º:</p>
<p>1.<strong>å¥–åŠ±æ¨¡å‹å’Œç­–ç•¥çš„ä»·å€¼å¤´å°† query
å’Œ response
çš„è¿æ¥ä½œä¸ºè¾“å…¥</strong></p>
<pre><code>1. å¥–åŠ±æ¨¡å‹å’Œç­–ç•¥çš„ä»·å€¼å¤´ *ä¸* ä»…ä»…æŸ¥çœ‹å“åº”ã€‚ç›¸åï¼Œå®ƒå°† query
</code></pre>
<p>å’Œ response
è¿æ¥åœ¨ä¸€èµ·ï¼Œä½œä¸º query_response
(lm_human_preferences/rewards.py#L105-L107)ã€‚</p>
<pre><code>2. ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœ query = &quot;ä»–åœ¨æƒ³æŸäº‹ï¼Œä½†ä»–çš„çœ¼ç¥å¾ˆéš¾è¯»æ‡‚&quot;ã€‚
</code></pre>
<p>ï¼Œå’Œ response = &ldquo;ä»–çœ‹ç€ä»–çš„å·¦æ‰‹ï¼Œæ‰‹è‡‚ä¼¸åœ¨ä»–çš„å‰é¢ã€‚&rdquo;
ï¼Œé‚£ä¹ˆå¥–åŠ±æ¨¡å‹å’Œç­–ç•¥çš„ä»·å€¼ä¼šå¯¹query_response = &ldquo;ä»–åœ¨æƒ³æŸäº‹ï¼Œä½†ä»–çš„çœ¼ç¥å¾ˆéš¾è¯»æ‡‚ã€‚ä»–çœ‹ç€ä»–çš„å·¦æ‰‹ï¼Œæ‰‹è‡‚ä¼¸åœ¨ä»–çš„å‰é¢ã€‚&rdquo;
è¿›è¡Œå‰å‘ä¼ é€’ï¼Œå¹¶äº§ç”Ÿå½¢çŠ¶ä¸º (B, T, 1)
çš„å¥–åŠ±å’Œä»·å€¼ï¼Œå…¶ä¸­ B
æ˜¯ BS (æ‰¹é‡å¤§å°)ï¼ŒT
æ˜¯åºåˆ—é•¿åº¦ï¼Œè€Œ 1
ä»£è¡¨å¥–åŠ±å¤´çš„è¾“å‡ºç»“æ„çš„ç»´åº¦ä¸º 1 (lm_human_preferences/rewards.py#L105-L107, lm_human_preferences/policy.py#L111)ã€‚</p>
<pre><code>3. T
</code></pre>
<p>æ„å‘³ç€æ¯ä¸ª token éƒ½æœ‰ä¸å…¶å’Œå‰æ–‡å…³è”çš„å¥–åŠ±ã€‚ä¾‹å¦‚ï¼Œeyes
token å°†æœ‰ä¸€ä¸ªä¸ä»–åœ¨æƒ³æŸäº‹ï¼Œä½†ä»–çš„çœ¼ç¥å¾ˆéš¾è¯»æ‡‚
ç›¸å¯¹åº”çš„å¥–åŠ±ã€‚</p>
<p>2.<strong>ä½¿ç”¨ç‰¹æ®Šçš„å¡«å…… token æ¥å¡«å……å’Œæˆªæ–­è¾“å…¥ã€‚</strong></p>
<pre><code>1.**å…³äº HF çš„ transformers â€” å¡«å…… token çš„æ³¨è§£ã€‚**  æ ¹æ® (transformers#2630#issuecomment-578159876)ï¼Œåœ¨ GPT å’Œ GPT-2 çš„é¢„è®­ç»ƒæœŸé—´æ²¡æœ‰ä½¿ç”¨å¡«å…… token; å› æ­¤ï¼Œtransformer çš„ gpt2 æ¨¡å‹ä¸å…¶åˆ†è¯å™¨æ²¡æœ‰å…³è”çš„å®˜æ–¹å¡«å…… tokenã€‚é€šå¸¸çš„åšæ³•æ˜¯è®¾ç½® tokenizer.pad_token = tokenizer.eos_token
</code></pre>
<p>ï¼Œä½†åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å°†åŒºåˆ†è¿™ä¸¤ä¸ªç‰¹æ®Š token ä»¥åŒ¹é… OAI çš„åŸå§‹è®¾ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ tokenizer.add_special_tokens({&ldquo;pad_token&rdquo;: &ldquo;[PAD]&rdquo;})
ã€‚</p>
<pre><code>2. OAI ä¸ºæŸ¥è¯¢ query_length
</code></pre>
<p>è®¾ç½®äº†å›ºå®šçš„è¾“å…¥é•¿åº¦; å®ƒä½¿ç”¨ pad_token
<strong>å¡«å……</strong>  è¿‡çŸ­çš„åºåˆ— (lm_human_preferences/language/datasets.py#L66-L67)ï¼Œå¹¶<strong>æˆªæ–­</strong>  è¿‡é•¿çš„åºåˆ— (lm_human_preferences/language/datasets.py#L57)ã€‚è¯¦è§ æ­¤å¤„ ä»¥è·å–è¯¥æ¦‚å¿µçš„é€šç”¨ä»‹ç»ã€‚åœ¨å¡«å……è¾“å…¥æ—¶ï¼ŒOAI ä½¿ç”¨äº†è¯æ±‡è¡¨ä¹‹å¤–çš„ token (lm_human_preferences/language/encodings.py#L56)ã€‚</p>
<p>æ³¨æ„ï¼Œæ²¡æœ‰å¡«å…… token æ˜¯è§£ç å™¨æ¨¡å‹çš„é»˜è®¤è®¾ç½®ï¼Œå› ä¸ºå®ƒä»¬åœ¨é¢„è®­ç»ƒæœŸé—´ä½¿ç”¨â€œæ‰“åŒ…â€è®­ç»ƒï¼Œè¿™æ„å‘³ç€è®¸å¤šåºåˆ—è¢«è¿æ¥å¹¶ç”± EOS token åˆ†éš”ï¼Œè¿™äº›åºåˆ—çš„å—åœ¨é¢„è®­ç»ƒæœŸé—´å§‹ç»ˆå…·æœ‰æœ€å¤§é•¿åº¦å¹¶è¢«é¦ˆé€åˆ°æ¨¡å‹ä¸­ã€‚</p>
<pre><code>3. å½“æŠŠæ‰€æœ‰äº‹ç‰©æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­        
    importÂ transformers  
    tokenizerÂ =Â transformers.AutoTokenizer.from_pretrained(&quot;gpt2&quot;,Â padding_side=&quot;right&quot;)  
    tokenizer.add_special_tokens({&quot;pad_token&quot;:Â &quot;[PAD]&quot;})  
    query_lengthÂ =Â 5  
    textsÂ =Â [  
    Â Â Â Â &quot;usually,Â heÂ would&quot;,  
    Â Â Â Â &quot;sheÂ thoughtÂ aboutÂ it&quot;,  
    ]  
    tokensÂ =Â []  
    forÂ textÂ inÂ texts:  
    Â Â Â Â tokens.append(tokenizer.encode(text)[:query_length])  
      
    print(&quot;tokens&quot;,Â tokens)  
    inputsÂ =Â tokenizer.pad(  
    Â Â Â Â {&quot;input_ids&quot;:Â tokens},  
    Â Â Â Â padding=&quot;max_length&quot;,  
    Â Â Â Â max_length=query_length,  
    Â Â Â Â return_tensors=&quot;pt&quot;,  
    Â Â Â Â return_attention_mask=True,  
    )  
    print(&quot;inputs&quot;,Â inputs)  
      
    &quot;&quot;&quot;printsÂ are  
    tokensÂ [[23073,Â 11,Â 339,Â 561],Â [7091,Â 1807,Â 546,Â 340]]  
    inputsÂ {'input_ids':Â tensor([[23073,Â 11,Â 339,Â 561,Â 50257],  
    Â Â Â Â Â Â Â Â [Â 7091,Â 1807,Â 546,Â 340,Â 50257]]),Â 'attention_mask':Â tensor([[1,Â 1,Â 1,Â 1,Â 0],  
    Â Â Â Â Â Â Â Â [1,Â 1,Â 1,Â 1,Â 0]])}  
    &quot;&quot;&quot;  
</code></pre>
<p>3.<strong>ç›¸åº”åœ°è°ƒæ•´å¡«å…… token çš„ä½ç½®ç´¢å¼•</strong></p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡ ä¹ä»ä¸åœ¨ transformers ä¸­ä¼ é€’ position_ids
ã€‚æ‰€æœ‰çš„é®è”½ (masking) å’Œç§»ä½ (shifting) logic å·²ç»å®ç°ï¼Œä¾‹å¦‚ï¼Œåœ¨ generate
å‡½æ•°ä¸­ (éœ€è¦æ°¸ä¹…çš„ä»£ç é“¾æ¥)ã€‚</p>
<pre><code>1. åœ¨è®¡ç®— logits æ—¶ï¼ŒOAI çš„ä»£ç é€šè¿‡é€‚å½“åœ°å±è”½å¡«å…… token æ¥å·¥ä½œã€‚è¿™æ˜¯é€šè¿‡æ‰¾å‡ºä¸å¡«å…… token ç›¸å¯¹åº”çš„ token ç´¢å¼•æ¥å®ç°çš„ (lm_human_preferences/language/model.py#L296-L297)ï¼Œç„¶åç›¸åº”åœ°è°ƒæ•´å®ƒä»¬çš„ä½ç½®ç´¢å¼• (lm_human_preferences/language/model.py#L320)ã€‚




2. ä¾‹å¦‚ï¼Œå¦‚æœ query=[23073, 50259, 50259]
</code></pre>
<p>å’Œ response=[11, 339, 561]
ï¼Œå…¶ä¸­ ( 50259
æ˜¯ OAI çš„å¡«å…… token)ï¼Œå®ƒä¼šåˆ›å»ºä½ç½®ç´¢å¼•ä¸º [[0 1 1 1 2 3]]
å¹¶ä¸”å¦‚ä¸‹çš„ logitsã€‚æ³¨æ„å¡«å…… token å¯¹åº”çš„ logits å¦‚ä½•ä¿æŒä¸å˜ï¼è¿™æ˜¯æˆ‘ä»¬åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­åº”è¯¥è¿½æ±‚çš„æ•ˆæœã€‚     <br>
all_logitsÂ [[[Â -35.28693Â -34.2875Â -38.16074Â &hellip;Â -41.595802Â -41.082108<br>
Â Â Â Â -35.36577Â ]<br>
[Â -35.28693Â -34.2875Â -38.16074Â &hellip;Â -41.595802Â -41.082108<br>
Â Â Â Â -35.36577Â ]<br>
[Â -35.28693Â -34.2875Â -38.16074Â &hellip;Â -41.595802Â -41.082108<br>
Â Â Â Â -35.36577Â ]<br>
[-111.303955Â -110.94471Â -112.90624Â &hellip;Â -113.13064Â -113.7788<br>
-109.17345Â ]<br>
[-111.51512Â -109.61077Â -114.90231Â &hellip;Â -118.43514Â -111.56671<br>
-112.12478Â ]<br>
[-122.69775Â -121.84468Â -128.27417Â &hellip;Â -132.28055Â -130.39604<br>
-125.707756]]]Â (1,Â 6,Â 50257)</p>
<pre><code>3.**å…³äº HF çš„ transformers â€” position_ids
</code></pre>
<p>å’Œ padding_side
çš„æ³¨è§£ã€‚**  æˆ‘ä»¬å¯ä»¥é€šè¿‡ 1) å·¦å¡«å……å’Œ 2) ä¼ å…¥é€‚å½“çš„ position_ids
ï¼Œä½¿ç”¨ Hugging Face çš„ transformer å¤åˆ¶ç²¾ç¡®çš„ logits:     <br>
importÂ torch<br>
importÂ transformers<br>
tokenizerÂ =Â transformers.AutoTokenizer.from_pretrained(&ldquo;gpt2&rdquo;,Â padding_side=&ldquo;right&rdquo;)<br>
tokenizer.add_special_tokens({&ldquo;pad_token&rdquo;:Â &ldquo;[PAD]&rdquo;})<br>
pad_idÂ =Â tokenizer.pad_token_id<br>
queryÂ =Â torch.tensor([<br>
Â Â Â Â [pad_id,Â pad_id,Â 23073],<br>
])<br>
responseÂ =Â torch.tensor([<br>
Â Â Â Â [11,Â 339,Â 561],<br>
])<br>
temperatureÂ =Â 1.0</p>
<pre><code>    queryÂ =Â torch.tensor(query)  
    responseÂ =Â torch.tensor(response).long()  
    context_lengthÂ =Â query.shape[1]  
    query_responseÂ =Â torch.cat((query,Â response),Â 1)  
    pretrained_modelÂ =Â transformers.AutoModelForCausalLM.from_pretrained(&quot;gpt2&quot;)  
    defÂ forward(policy,Â query_responses,Â tokenizer):  
    Â Â Â Â attention_maskÂ =Â query_responsesÂ !=Â tokenizer.pad_token_id  
    Â Â Â Â position_idsÂ =Â attention_mask.cumsum(1)Â -Â attention_mask.long()Â #Â exclusiveÂ cumsum  
    Â Â Â Â input_idsÂ =Â query_responses.clone()  
    Â Â Â Â input_ids[~attention_mask]Â =Â 0  
    Â Â Â Â returnÂ policy(  
    Â Â Â Â Â Â Â Â input_ids=input_ids,  
    Â Â Â Â Â Â Â Â attention_mask=attention_mask,  
    Â Â Â Â Â Â Â Â position_ids=position_ids,  
    Â Â Â Â Â Â Â Â return_dict=True,  
    Â Â Â Â Â Â Â Â output_hidden_states=True,  
    Â Â Â Â )  
    outputÂ =Â forward(pretrained_model,Â query_response,Â tokenizer)  
    logitsÂ =Â output.logits  
    logitsÂ /=Â temperature  
    print(logits)  
      
    &quot;&quot;&quot;  
    tensor([[[Â -26.9395,Â -26.4709,Â -30.0456,Â ...,Â -33.2208,Â -33.2884,  
    Â Â Â Â Â Â Â Â -27.4360],  
    Â Â Â Â Â Â Â Â [Â -27.1677,Â -26.7330,Â -30.2386,Â ...,Â -33.6813,Â -33.6931,  
    Â Â Â Â Â Â Â Â -27.5928],  
    Â Â Â Â Â Â Â Â [Â -35.2869,Â -34.2875,Â -38.1608,Â ...,Â -41.5958,Â -41.0821,  
    Â Â Â Â Â Â Â Â -35.3658],  
    Â Â Â Â Â Â Â Â [-111.3040,Â -110.9447,Â -112.9062,Â ...,Â -113.1306,Â -113.7788,  
    Â Â Â Â Â Â Â Â -109.1734],  
    Â Â Â Â Â Â Â Â [-111.5152,Â -109.6108,Â -114.9024,Â ...,Â -118.4352,Â -111.5668,  
    Â Â Â Â Â Â Â Â -112.1248],  
    Â Â Â Â Â Â Â Â [-122.6978,Â -121.8447,Â -128.2742,Â ...,Â -132.2805,Â -130.3961,  
    Â Â Â Â Â Â Â Â -125.7078]]],Â grad_fn=&lt;DivBackward0&gt;)  
    &quot;&quot;&quot;  
    
    




4.**å…³äº HF çš„ transformers â€”â€”åœ¨ ç”Ÿæˆ
</code></pre>
<p>è¿‡ç¨‹ä¸­çš„ position_ids
çš„æ³¨è§£:**  åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸åº”ä¼ å…¥ position_ids
ï¼Œå› ä¸ºåœ¨ transformers
ä¸­ï¼Œ position_ids
å·²ç»ä»¥æŸç§æ–¹å¼è¢«è°ƒæ•´äº†ã€‚å½“æˆ‘åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ä¹Ÿä¼ å…¥ position_ids
æ—¶ï¼Œæ€§èƒ½ä¼šç¾éš¾æ€§åœ°æ¶åŒ–ã€‚</p>
<p>4.<strong>ç”Ÿæˆå›ºå®šé•¿åº¦å“åº”çš„å“åº”ç”Ÿæˆä¸éœ€è¦å¡«å……ã€‚</strong></p>
<pre><code>1. åœ¨å“åº”ç”ŸæˆæœŸé—´ï¼ŒOAI ä½¿ç”¨ top_k=0, top_p=1.0
</code></pre>
<p>å¹¶ä»…åœ¨è¯æ±‡è¡¨ä¸Šåšåˆ†ç±»æ ·æœ¬ (lm_human_preferences/language/sample.py#L43)ï¼Œä»£ç ä¼šä¸€ç›´é‡‡æ ·ï¼Œç›´åˆ°ç”Ÿæˆå›ºå®šé•¿åº¦çš„å“åº” (lm_human_preferences/policy.py#L103)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿é‡åˆ° EOS (åºåˆ—ç»“æŸ) token ï¼Œå®ƒä¹Ÿä¼šç»§ç»­é‡‡æ ·ã€‚</p>
<pre><code>2.**å…³äº HF çš„ transformers çš„æ³¨è§£ â€” åœ¨ eos_token
</code></pre>
<p>å¤„é‡‡æ ·å¯èƒ½ä¼šåœæ­¢:**  åœ¨ transformers
ä¸­ï¼Œç”Ÿæˆå¯èƒ½ä¼šåœ¨ eos_token
å¤„åœæ­¢ (src/transformers/generation/utils.py#L2248-L2256)ï¼Œè¿™ä¸ OAI çš„è®¾ç½®ä¸åŒã€‚ä¸ºäº†å¯¹é½è®¾ç½®ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® pretrained_model.generation_config.eos_token_id = None, pretrained_model.generation_config.pad_token_id = None
ã€‚è¯·æ³¨æ„ï¼Œ transformers.GenerationConfig(eos_token_id=None, pad_token_id=None, &hellip;)
ä¸èµ·ä½œç”¨ï¼Œå› ä¸º pretrained_model.generation_config
ä¼šè¦†ç›–å¹¶è®¾ç½®ä¸€ä¸ª eos_token
ã€‚     <br>
importÂ torch<br>
importÂ transformers<br>
tokenizerÂ =Â transformers.AutoTokenizer.from_pretrained(&ldquo;gpt2&rdquo;,Â padding_side=&ldquo;right&rdquo;)<br>
tokenizer.add_special_tokens({&ldquo;pad_token&rdquo;:Â &ldquo;[PAD]&rdquo;})<br>
pad_idÂ =Â tokenizer.pad_token_id<br>
queryÂ =Â torch.tensor([<br>
Â Â Â Â [pad_id,Â pad_id,Â 23073],<br>
])<br>
responseÂ =Â torch.tensor([<br>
Â Â Â Â [11,Â 339,Â 561],<br>
])<br>
response_lengthÂ =Â 4<br>
temperatureÂ =Â 0.7<br>
pretrained_modelÂ =Â transformers.AutoModelForCausalLM.from_pretrained(&ldquo;gpt2&rdquo;)<br>
pretrained_model.generation_config.eos_token_idÂ =Â NoneÂ #Â disableÂ <code>pad_token_id</code>Â andÂ <code>eos_token_id</code>Â becauseÂ weÂ justÂ wantÂ to<br>
pretrained_model.generation_config.pad_token_idÂ =Â NoneÂ #Â generateÂ tokensÂ withoutÂ truncationÂ /Â padding<br>
generation_configÂ =Â transformers.GenerationConfig(<br>
Â Â Â Â max_new_tokens=response_length,<br>
Â Â Â Â min_new_tokens=response_length,<br>
Â Â Â Â temperature=temperature,<br>
Â Â Â Â top_k=0.0,<br>
Â Â Â Â top_p=1.0,<br>
Â Â Â Â do_sample=True,<br>
)<br>
context_lengthÂ =Â query.shape[1]<br>
attention_maskÂ =Â queryÂ !=Â tokenizer.pad_token_id<br>
input_idsÂ =Â query.clone()<br>
input_ids[~attention_mask]Â =Â 0Â #Â setÂ paddingÂ tokensÂ toÂ 0<br>
outputÂ =Â pretrained_model.generate(<br>
Â Â Â Â input_ids=input_ids,<br>
Â Â Â Â attention_mask=attention_mask,<br>
Â Â Â Â #Â position_ids=attention_mask.cumsum(1)Â -Â attention_mask.long(),Â #Â generationÂ collapsedÂ ifÂ thisÂ wasÂ turnedÂ on.Â TODO:Â whyÂ doesÂ generationÂ collapseÂ withÂ this?<br>
Â Â Â Â generation_config=generation_config,<br>
Â Â Â Â return_dict_in_generate=True,<br>
)<br>
print(output.sequences)</p>
<pre><code>    &quot;&quot;&quot;  
    tensor([[Â 0,Â 0,Â 23073,Â 16851,Â 11,Â 475,Â 991]])  
    &quot;&quot;&quot;  
    
    




3. è¯·æ³¨æ„ï¼Œåœ¨è¾ƒæ–°çš„ä»£ç åº“ https://github.com/openai/summarize-from-feedback ä¸­ï¼Œå½“é‡åˆ° EOS token æ—¶ï¼ŒOAI ç¡®å®ä¼šåœæ­¢é‡‡æ · (summarize_from_feedback/utils/experiment_helpers.py#L19)ã€‚ç„¶è€Œï¼Œåœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¿›è¡Œ 1:1 çš„å¤åˆ»ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒæ•´äº†è®¾ç½®ï¼Œå³ä½¿é‡åˆ° eos_token ä¹Ÿå¯ä»¥ç»§ç»­é‡‡æ ·ã€‚
</code></pre>
<p>5.<strong>å¥–åŠ±æ¨¡å‹å’Œç­–ç•¥è®­ç»ƒçš„å­¦ä¹ ç‡é€€ç«ã€‚</strong></p>
<pre><code>1. æ­£å¦‚ Ziegler ç­‰äºº (2019) å»ºè®®çš„ï¼Œå¥–åŠ±æ¨¡å‹åªè®­ç»ƒä¸€ä¸ª epchoï¼Œä»¥é¿å…è¿‡åº¦æ‹Ÿåˆæœ‰é™é‡çš„äººç±»æ³¨é‡Šæ•°æ® (ä¾‹å¦‚ï¼Œdescriptiveness
</code></pre>
<p>ä»»åŠ¡åªæœ‰å¤§çº¦ 5000 ä¸ªæ ‡ç­¾)ã€‚åœ¨è¿™ä¸ªå•ä¸€çš„ epcho ä¸­ï¼Œå­¦ä¹ ç‡ä¼šé€€ç«è‡³é›¶ (lm_human_preferences/train_reward.py#L249)ã€‚</p>
<pre><code>2. ç±»ä¼¼äºå¥–åŠ±æ¨¡å‹è®­ç»ƒï¼Œç­–ç•¥è®­ç»ƒçš„å­¦ä¹ ç‡ä¹Ÿä¼šé€€ç«è‡³é›¶ (lm_human_preferences/train_policy.py#L172-L173)ã€‚
</code></pre>
<p>6.<strong>ä¸ºä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„ç§å­</strong></p>
<pre><code>1. æ³¨: æˆ‘è®¤ä¸ºæ•°æ®é›†çš„æ´—ç‰Œ (shuffling) å­˜åœ¨ä¸€ä¸ªé”™è¯¯â€”â€”ç”±äºæŸç§åŸå› ï¼Œæ•°æ®é›†æ˜¯ä½¿ç”¨ç›¸åŒçš„ç§å­è¿›è¡Œæ´—ç‰Œçš„ (lm_human_preferences/lm_tasks.py#L94-L97)ã€‚


2. åœ¨ç”Ÿæˆ 8 ä¸ª GPU è¿›ç¨‹è¿›è¡Œæ•°æ®å¹¶è¡Œæ—¶ï¼ŒOAI ä¸ºæ¯ä¸ªè¿›ç¨‹è®¾ç½®äº†ä¸åŒçš„éšæœºç§å­ (lm_human_preferences/utils/core.py#L108-L111)ã€‚åœ¨å®ç°ä¸Šï¼Œè¿™æ˜¯é€šè¿‡ local_seed = args.seed + process_rank * 100003
</code></pre>
<p>å®Œæˆçš„ã€‚ç§å­ä¼šè®©æ¨¡å‹äº§ç”Ÿä¸åŒçš„å“åº”å¹¶å¾—åˆ°ä¸åŒçš„åˆ†æ•°ï¼Œä¾‹å¦‚ã€‚</p>
<h4 id="å¥–åŠ±æ¨¡å‹å®ç°ç»†èŠ‚">å¥–åŠ±æ¨¡å‹å®ç°ç»†èŠ‚</h4>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¥–åŠ±æ¨¡å‹ç‰¹å®šçš„å®ç°ç»†èŠ‚ã€‚æˆ‘ä»¬è®¨è®ºäº†è¯¸å¦‚å¥–åŠ±å½’ä¸€åŒ–å’Œå±‚åˆå§‹åŒ–ç­‰ç»†èŠ‚ã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç»†èŠ‚ï¼Œä¸æŒ‰ç‰¹å®šé¡ºåºæ’åˆ—:</p>
<p>1.<strong>å¥–åŠ±æ¨¡å‹åªè¾“å‡ºæœ€åä¸€ä¸ª token çš„å€¼ã€‚</strong></p>
<pre><code>1. è¯·æ³¨æ„ï¼Œåœ¨å¯¹ query
</code></pre>
<p>å’Œ response
çš„è¿æ¥è¿›è¡Œå‰å‘ä¼ é€’åè·å¾—çš„å¥–åŠ±å°†å…·æœ‰å½¢çŠ¶ (B, T, 1)
ï¼Œå…¶ä¸­ B
æ˜¯ BS(æ‰¹é‡å¤§å°)ï¼ŒT
æ˜¯åºåˆ—é•¿åº¦ (å§‹ç»ˆç›¸åŒ; åœ¨ OAI çš„è®¾ç½®ä¸­ï¼Œå®ƒæ˜¯ query_length + response_length = 64 + 24 = 88
ï¼Œç”¨äºé£æ ¼ä»»åŠ¡ï¼Œå‚è§ launch.py#L9-L11)ï¼Œ1
æ˜¯å¥–åŠ±å¤´å…¶ç»´åº¦ä¸º 1ã€‚å¯¹äº RLHF (Reinforcement Learning from Human Feedbackï¼Œé€šè¿‡äººç±»åé¦ˆè¿›è¡Œå¼ºåŒ–å­¦ä¹ ) çš„ç›®çš„ï¼ŒåŸå§‹ä»£ç åº“æå–æœ€åä¸€ä¸ª token çš„å¥–åŠ± (lm_human_preferences/rewards.py#L132)ï¼Œå› æ­¤å¥–åŠ±å°†åªå…·æœ‰å½¢çŠ¶ (B, 1)
ã€‚</p>
<pre><code>2. è¯·æ³¨æ„ï¼Œåœ¨è¾ƒæ–°çš„ä»£ç åº“ *openai/summarize-from-feedback* ä¸­ï¼ŒOAI åœ¨é‡åˆ° EOS token æ—¶åœæ­¢é‡‡æ · (summarize_from_feedback/utils/experiment_helpers.py#L19)ã€‚åœ¨æå–å¥–åŠ±æ—¶ï¼Œå®ƒå°†ç¡®å®š last_response_index
</code></pre>
<p>ï¼Œå³ EOS token ä¹‹å‰çš„ç´¢å¼• (#L11-L13)ï¼Œå¹¶åœ¨è¯¥ç´¢å¼•å¤„æå–å¥–åŠ± (summarize_from_feedback/reward_model.py#L59)ã€‚ä½†åœ¨æ­¤å·¥ä½œä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åšæŒåŸå§‹è®¾ç½®ã€‚</p>
<p>2.<strong>å¥–åŠ±å¤´å±‚åˆå§‹åŒ–</strong></p>
<pre><code>1. å¥–åŠ±å¤´çš„æƒé‡æ˜¯æ ¹æ® ( \mathcal{N}\left(0,1 /\left(\sqrt{d_{\text {model }}+1}\right)\right) ) åˆå§‹åŒ–çš„ (lm_human_preferences/language/model.py#L368, lm_human_preferences/language/model.py#L251-L252)ã€‚è¿™ä¸ Stiennon ç­‰äººçš„è®¾ç½®ç›¸ç¬¦ï¼Œ2020 å¹´ (summarize_from_feedback/query_response_model.py#L106-L107) (é™„æ³¨ï¼ŒStiennon ç­‰äººï¼Œ2020 å¹´åœ¨ç¬¬ 17 é¡µä¸Šæœ‰ä¸€ä¸ªé”™å­—ï¼Œè¡¨ç¤ºåˆ†å¸ƒæ˜¯ ( \mathcal{N}\left(0,1 /\left(d_{\text {model }}+1\right)\right) ) æ²¡æœ‰å¹³æ–¹æ ¹)


2. å¥–åŠ±å¤´çš„ bias (åç½®) è®¾ä¸º 0 (lm_human_preferences/language/model.py#L254)ã€‚
</code></pre>
<p>3.<strong>å¥–åŠ±æ¨¡å‹çš„å‰åå½’ä¸€åŒ–</strong></p>
<pre><code>1. åœ¨è®ºæ–‡ä¸­ï¼ŒZiegler ç­‰äºº (2019) æåˆ°â€œä¸ºäº†ä¿æŒè®­ç»ƒè¿‡ç¨‹ä¸­å¥–åŠ±æ¨¡å‹çš„è§„æ¨¡ä¸€è‡´ï¼Œæˆ‘ä»¬å°†å…¶å½’ä¸€åŒ–ï¼Œä½¿å…¶åœ¨ ( x \sim \mathcal{D}, y \sim \rho(Â·|x) ) çš„æƒ…å†µä¸‹ï¼Œå‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1â€ã€‚ä¸ºäº†æ‰§è¡Œå½’ä¸€åŒ–è¿‡ç¨‹ï¼Œä»£ç é¦–å…ˆåˆ›å»ºäº† reward_gain
</code></pre>
<p>å’Œ reward_bias
ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ reward = reward * reward_gain + reward_bias
æ¥è®¡ç®—å¥–åŠ±å€¼ (lm_human_preferences/rewards.py#L50-L51)ã€‚</p>
<pre><code>2. åœ¨æ‰§è¡Œå½’ä¸€åŒ–è¿‡ç¨‹æ—¶ï¼Œä»£ç é¦–å…ˆè®¾ç½® reward_gain=1, reward_bias=0
</code></pre>
<p>(lm_human_preferences/train_reward.py#L211)ï¼Œç„¶åä»ç›®æ ‡æ•°æ®é›† (ä¾‹å¦‚ï¼Œbookcorpus, tldr, cnndm
) ä¸­æ”¶é›†é‡‡æ ·æŸ¥è¯¢ã€å®Œæˆçš„å“åº”å’Œè¯„ä¼°çš„å¥–åŠ±ã€‚æ¥ç€ï¼Œå®ƒå¾—åˆ°è¯„ä¼°å¥–åŠ±çš„<strong>å®è¯å‡å€¼å’Œæ ‡å‡†å·®</strong>  (lm_human_preferences/train_reward.py#L162-L167)ï¼Œå¹¶å°è¯•è®¡ç®— reward_gain
å’Œ reward_bias
åº”è¯¥æ˜¯ä»€ä¹ˆã€‚</p>
<pre><code>3. æˆ‘ä»¬ç”¨( \mu_{\mathcal{D}} ) æ¥è¡¨ç¤ºå®è¯å‡å€¼ï¼Œç”¨( \sigma_{\mathcal{D}} ) è¡¨ç¤ºå®è¯æ ‡å‡†å·®ï¼Œç”¨(g) è¡¨ç¤º reward_gain
</code></pre>
<p>ï¼Œç”¨(b) è¡¨ç¤º reward_bias
ï¼Œç”¨( \mu_{\mathcal{T}} = 0) è¡¨ç¤º<strong>ç›®æ ‡å‡å€¼</strong> ï¼Œç”¨( \sigma_{\mathcal{T}}=1) è¡¨ç¤º<strong>ç›®æ ‡æ ‡å‡†å·®</strong> ã€‚ç„¶åæˆ‘ä»¬æœ‰ä»¥ä¸‹å…¬å¼ã€‚</p>
<pre><code>4. ç„¶ååœ¨å¥–åŠ±æ¨¡å‹è®­ç»ƒçš„**å‰**  å’Œ**å**  åº”ç”¨å½’ä¸€åŒ–è¿‡ç¨‹ (lm_human_preferences/train_reward.py#L232-L234ï¼Œlm_human_preferences/train_reward.py#L252-L254)ã€‚




5. è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ºå½’ä¸€åŒ–ç›®çš„ç”Ÿæˆçš„å“åº” ( y \sim \rho(Â·|x) ) æ¥è‡ªé¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹ (\rho )ã€‚æ¨¡å‹ (\rho ) è¢«å›ºå®šä¸ºå‚è€ƒï¼Œå¹¶ä¸”åœ¨å¥–åŠ±å­¦ä¹ ä¸­ä¸ä¼šæ›´æ–° (lm_human_preferences/train_reward.py#L286C1-L286C31)ã€‚
</code></pre>
<h4 id="ç­–ç•¥è®­ç»ƒå®ç°ç»†èŠ‚">ç­–ç•¥è®­ç»ƒå®ç°ç»†èŠ‚</h4>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¯¸å¦‚å±‚åˆå§‹åŒ–ã€æ•°æ®åå¤„ç†å’Œ dropout è®¾ç½®ç­‰ç»†èŠ‚ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨ä¸€äº›æŠ€æœ¯ï¼Œå¦‚æ‹’ç»é‡‡æ ·å’Œå¥–åŠ± â€œç™½åŒ–â€ï¼Œä»¥åŠè‡ªé€‚åº” KLã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç»†èŠ‚ï¼Œæ’åˆ—ä¸åˆ†å…ˆå:</p>
<p>1.<strong>é€šè¿‡é‡‡æ ·æ¸©åº¦æ¥ç¼©æ”¾ logits</strong></p>
<pre><code>1. åœ¨è®¡ç®—å“åº”çš„å¯¹æ•°æ¦‚ç‡æ—¶ï¼Œæ¨¡å‹é¦–å…ˆè¾“å‡ºå“åº”ä¸­ token çš„ logitsï¼Œç„¶åç”¨é‡‡æ ·æ¸©åº¦é™¤ä»¥è¿™äº› logits (lm_human_preferences/policy.py#L121)ã€‚å³ logits /= self.temperature



2. åœ¨ä¸€ä¸ªéæ­£å¼çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°å¦‚æœä¸è¿›è¡Œæ­¤ç¼©æ”¾ï¼ŒKL æ•£åº¦ä¼šæ¯”é¢„æœŸæ›´å¿«åœ°ä¸Šå‡ï¼Œæ€§èƒ½ä¼šä¸‹é™ã€‚
</code></pre>
<p>2.<strong>ä»·å€¼å¤´å±‚çš„åˆå§‹åŒ–</strong></p>
<pre><code>1. ä»·å€¼å¤´çš„æƒé‡æ˜¯æ ¹æ® (\mathcal{N}(0,0)) è¿›è¡Œåˆå§‹åŒ–çš„ (lm_human_preferences/language/model.py#L368ã€lm_human_preferences/language/model.py#L251-L252)ã€‚


2. å¥–åŠ±å¤´çš„ bias (åç½®) è®¾ç½®ä¸º 0 (lm_human_preferences/language/model.py#L254)ã€‚
</code></pre>
<p>3.<strong>é€‰æ‹©ä»¥å¥å·å¼€å§‹å’Œç»“æŸçš„æŸ¥è¯¢æ–‡æœ¬</strong></p>
<pre><code>1. å°è¯•ä»…åœ¨ start_text=&quot;.&quot;
</code></pre>
<p>ä¹‹åé€‰æ‹©æ–‡æœ¬ (lm_human_preferences/language/datasets.py#L51)</p>
<pre><code>2. å°è¯•åœ¨ end_text=&quot;.&quot;
</code></pre>
<p>ä¹‹å‰é€‰æ‹©æ–‡æœ¬ (lm_human_preferences/language/datasets.py#L61)</p>
<pre><code>3. ç„¶åå¡«å……æ–‡æœ¬ (lm_human_preferences/language/datasets.py#L66-L67)


4. è¿™æ˜¯æ•°æ®é¢„å¤„ç†çš„ä¸€éƒ¨åˆ†:




5. åœ¨è¿è¡Œ openai/lm-human-preferences
</code></pre>
<p>æ—¶ï¼ŒOAI çš„æ•°æ®é›†éƒ¨åˆ†æŸå/ä¸¢å¤± (openai/lm-human-preferences/issues/17#issuecomment-104405149)ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸ç”¨ç±»ä¼¼çš„ HF æ•°æ®é›†æ›¿æ¢å®ƒä»¬ï¼Œè¿™å¯èƒ½ä¼šæˆ–å¯èƒ½ä¸ä¼šå¯¼è‡´æ€§èƒ½å·®å¼‚ã€‚</p>
<pre><code>6. å¯¹äºä¹¦ç±æ•°æ®é›†ï¼Œæˆ‘ä»¬ä½¿ç”¨ https://huggingface.co/datasets/bookcorpusï¼Œæˆ‘ä»¬å‘ç°æ²¡æœ‰å¿…è¦æå–ä»¥å¥å·å¼€å§‹å’Œç»“æŸçš„å¥å­ï¼Œå› ä¸ºæ•°æ®é›†å·²ç»æ˜¯è¿™æ ·é¢„å¤„ç†è¿‡çš„ (ä¾‹å¦‚ï¼Œ&quot;usually , he would be tearing around the living room , playing with his toys.&quot;
</code></pre>
<p>) ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸º sentiment
å’Œ descriptiveness
ä»»åŠ¡è®¾ç½® start_text=None, end_text=None
ã€‚</p>
<p>4.<strong>ç¦ç”¨ dropout</strong></p>
<pre><code>1. Ziegler ç­‰äºº (2019) å»ºè®®ï¼Œâ€œæˆ‘ä»¬åœ¨ç­–ç•¥è®­ç»ƒä¸­ä¸ä½¿ç”¨ dropoutã€‚â€ è¿™ä¹Ÿåœ¨ä»£ç ä¸­å®ç°äº† (lm_human_preferences/policy.py#L48)ã€‚
</code></pre>
<p>5.<strong>æ‹’ç»é‡‡æ ·</strong></p>
<pre><code>1.**token æˆªæ–­** : æˆ‘ä»¬æƒ³è¦åœ¨ç¬¬ä¸€ä¸ªå‡ºç°åœ¨å“åº”çš„ truncate_after
</code></pre>
<p>ä½ç½®ä¹‹åçš„ truncate_token
å¤„æˆªæ–­ (lm_human_preferences/train_policy.py#L378)ã€‚</p>
<pre><code>2.**åœ¨æˆªæ–­å“åº”ä¸Šè¿è¡Œå¥–åŠ±æ¨¡å‹** : åœ¨ token æˆªæ–­è¿‡ç¨‹å°†å“åº”æˆªæ–­åï¼Œä»£ç ç„¶ååœ¨**æˆªæ–­çš„å“åº”**  ä¸Šè¿è¡Œå¥–åŠ±æ¨¡å‹ã€‚




3.**æ‹’ç»é‡‡æ ·** : å¦‚æœåœ¨ç¬¬ 16 å’Œ 24 ä¸ª token ä¹‹é—´æ²¡æœ‰å¥å·ï¼Œé‚£ä¹ˆå°†å“åº”çš„åˆ†æ•°æ›¿æ¢ä¸ºå›ºå®šçš„ä½å€¼ (ä¾‹å¦‚ -1) (lm_human_preferences/train_policy.py#L384ã€lm_human_preferences/train_policy.py#L384-L402)ã€‚




4. åœ¨ descriptiveness
</code></pre>
<p>ä¸­ä¸¾ä¸€äº›ä¾‹å­:</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVC9ricHesicY7AFpMCscNuLvFAhSgJC5jIrbyxSiaZBt5JQoqGjxMDDoCA/640?wx_fmt=png" alt=""></p>
<p>ä»æˆ‘ä»¬çš„å¤åˆ¶ä¸­æå–çš„æ ·æœ¬ <a href="https://wandb.ai/openrlbenchmark/lm_human_preference_details/runs/djf8yymv/logs">https://wandb.ai/openrlbenchmark/lm_human_preference_details/runs/djf8yymv/logs</a>ã€‚è¯·æ³¨æ„ï¼Œç¬¬ 1 å’Œç¬¬ 3 ä¸ªç¤ºä¾‹åœ¨å¥å·åæœ‰å¤ªå¤š tokenï¼Œå› æ­¤å…¶åˆ†æ•°è¢«æ›¿æ¢ä¸º -1ã€‚</p>
<pre><code>5. ä»£ç æ³¨é‡Š: â€œä¸­å¿ƒç¤ºä¾‹: å°†æˆªæ–­ token åçš„æ‰€æœ‰ token æ›¿æ¢ä¸ºå¡«å…… tokenâ€


6. ä»£ç æ³¨é‡Š: â€œä¸­å¿ƒç¤ºä¾‹: ç¡®ä¿æ ·æœ¬åŒ…å« truncate_token
</code></pre>
<p>â€œ</p>
<pre><code>7. ä»£ç æ³¨é‡Š: â€œåªå¯¹é€šè¿‡è¯¥åŠŸèƒ½çš„å“åº”è¿›è¡Œäººç±»æŸ¥è¯¢â€


8. Ziegler ç­‰äºº (2019) å»ºè®®: â€œæˆ‘ä»¬ä½¿ç”¨æ‹’ç»é‡‡æ ·æ¥ç¡®ä¿åœ¨ç¬¬ 16 å’Œ 24 ä¸ª token ä¹‹é—´æœ‰ä¸€ä¸ªå¥å·ï¼Œç„¶ååœ¨é‚£ä¸ªå¥å·å¤„æˆªæ–­ (è¿™æ˜¯â€˜å¥å­ç»“æŸâ€™çš„ç²—ç•¥è¿‘ä¼¼ã€‚æˆ‘ä»¬é€‰æ‹©å®ƒæ˜¯å› ä¸ºå®ƒå¾ˆå®¹æ˜“é›†æˆåˆ° RL å¾ªç¯ä¸­ï¼Œå³ä½¿æ˜¯ç²—ç•¥çš„è¿‘ä¼¼ä¹Ÿè¶³ä»¥ä½¿äººç±»è¯„ä¼°ä»»åŠ¡å˜å¾—ç¨å¾®å®¹æ˜“ä¸€äº›)ã€‚åœ¨ RL å¾®è°ƒæœŸé—´ï¼Œæˆ‘ä»¬å¯¹æ²¡æœ‰è¿™æ ·çš„å¥å·çš„å»¶ç»­ç»™äºˆå›ºå®šå¥–åŠ± -1ã€‚â€


9. å…·ä½“æ¥è¯´ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°æ­¤ç›®çš„:
</code></pre>
<p>6.<strong>æŠ˜ç°å› å­ (discount factor) = 1</strong></p>
<pre><code>1. æŠ˜ç°å› å­ (\gamma) è®¾ç½®ä¸º 1 (lm_human_preferences/train_policy.py#L56)ï¼Œè¿™æ„å‘³ç€æœªæ¥çš„å¥–åŠ±ä¸å³æ—¶å¥–åŠ±å…·æœ‰ç›¸åŒçš„æƒé‡ã€‚
</code></pre>
<p>7.<strong>è®­ç»ƒå¾ªç¯çš„æœ¯è¯­: PPO ä¸­çš„æ‰¹æ¬¡å’Œå°æ‰¹æ¬¡</strong></p>
<pre><code>1. OAI ä½¿ç”¨ä»¥ä¸‹è®­ç»ƒå¾ªç¯ (lm_human_preferences/train_policy.py#L184-L192)ã€‚æ³¨æ„: æˆ‘ä»¬é¢å¤–æ·»åŠ äº† micro_batch_size
</code></pre>
<p>æ¥å¸®åŠ©å¤„ç†æ¢¯åº¦ç´¯ç§¯çš„æƒ…å†µã€‚åœ¨æ¯ä¸ªæ—¶æœŸï¼Œå®ƒéƒ½ä¼šæ´—ç‰Œæ‰¹æ¬¡ç´¢å¼•ã€‚     <br>
importÂ numpyÂ asÂ np<br>
batch_sizeÂ =Â 8<br>
nminibatchesÂ =Â 2<br>
gradient_accumulation_stepsÂ =Â 2<br>
mini_batch_sizeÂ =Â batch_sizeÂ //Â nminibatches<br>
micro_batch_sizeÂ =Â mini_batch_sizeÂ //Â gradient_accumulation_steps<br>
dataÂ =Â np.arange(batch_size).astype(np.float32)<br>
print(&ldquo;data:&quot;,Â data)<br>
print(&ldquo;batch_size:&quot;,Â batch_size)<br>
print(&ldquo;mini_batch_size:&quot;,Â mini_batch_size)<br>
print(&ldquo;micro_batch_size:&quot;,Â micro_batch_size)<br>
forÂ epochÂ inÂ range(4):<br>
Â Â Â Â batch_indsÂ =Â np.random.permutation(batch_size)<br>
Â Â Â Â print(&ldquo;epoch:&quot;,Â epoch,Â &ldquo;batch_inds:&quot;,Â batch_inds)<br>
Â Â Â Â forÂ mini_batch_startÂ inÂ range(0,Â batch_size,Â mini_batch_size):<br>
Â Â Â Â Â Â Â Â mini_batch_endÂ =Â mini_batch_startÂ +Â mini_batch_size<br>
Â Â Â Â Â Â Â Â mini_batch_indsÂ =Â batch_inds[mini_batch_start:mini_batch_end]<br>
Â Â Â Â Â Â Â Â <br>
Â Â Â Â Â Â Â Â #Â <code>optimizer.zero_grad()</code>Â setÂ optimizerÂ toÂ zeroÂ forÂ gradientÂ accumulation<br>
Â Â Â Â Â Â Â Â forÂ micro_batch_startÂ inÂ range(0,Â mini_batch_size,Â micro_batch_size):<br>
Â Â Â Â Â Â Â Â Â Â Â Â micro_batch_endÂ =Â micro_batch_startÂ +Â micro_batch_size<br>
Â Â Â Â Â Â Â Â Â Â Â Â micro_batch_indsÂ =Â mini_batch_inds[micro_batch_start:micro_batch_end]<br>
Â Â Â Â Â Â Â Â Â Â Â Â print(&rdquo;____â©Â aÂ forwardÂ passÂ on&rdquo;,Â data[micro_batch_inds])<br>
Â Â Â Â Â Â Â Â #Â <code>optimizer.step()</code><br>
Â Â Â Â Â Â Â Â print(&ldquo;âªÂ aÂ backwardÂ passÂ on&rdquo;,Â data[mini_batch_inds])</p>
<pre><code>    #Â data:Â [0.Â 1.Â 2.Â 3.Â 4.Â 5.Â 6.Â 7.]  
    #Â batch_size:Â 8  
    #Â mini_batch_size:Â 4  
    #Â micro_batch_size:Â 2  
    #Â epoch:Â 0Â batch_inds:Â [6Â 4Â 0Â 7Â 3Â 5Â 1Â 2]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [6.Â 4.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [0.Â 7.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [6.Â 4.Â 0.Â 7.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [3.Â 5.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [1.Â 2.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [3.Â 5.Â 1.Â 2.]  
    #Â epoch:Â 1Â batch_inds:Â [6Â 7Â 3Â 2Â 0Â 4Â 5Â 1]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [6.Â 7.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [3.Â 2.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [6.Â 7.Â 3.Â 2.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [0.Â 4.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [5.Â 1.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [0.Â 4.Â 5.Â 1.]  
    #Â epoch:Â 2Â batch_inds:Â [1Â 4Â 5Â 6Â 0Â 7Â 3Â 2]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [1.Â 4.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [5.Â 6.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [1.Â 4.Â 5.Â 6.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [0.Â 7.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [3.Â 2.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [0.Â 7.Â 3.Â 2.]  
    #Â epoch:Â 3Â batch_inds:Â [7Â 2Â 4Â 1Â 3Â 0Â 6Â 5]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [7.Â 2.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [4.Â 1.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [7.Â 2.Â 4.Â 1.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [3.Â 0.]  
    #Â ____â©Â aÂ forwardÂ passÂ onÂ [6.Â 5.]  
    #Â âªÂ aÂ backwardÂ passÂ onÂ [3.Â 0.Â 6.Â 5.]  
</code></pre>
<p>8.<strong>åŸºäºæ¯ä¸ªæ ‡è®°çš„ KL æƒ©ç½š</strong></p>
<pre><code>* åœ¨ç¬¬ä¸€ä¸ª PPO æ›´æ–°æ—¶æœŸå’Œå°æ‰¹æ¬¡æ›´æ–°æ—¶ï¼Œæ¿€æ´»ç­–ç•¥å°†å…·æœ‰ç›¸åŒçš„å¯¹æ•°æ¦‚ç‡new_logprobs=[-3.3213, -4.9980, -3.8690]
</code></pre>
<p>ã€‚å› æ­¤ï¼Œæ¯ä¸ªæ ‡è®°çš„ KL æƒ©ç½šå°†ä¸º kl = new_logprobs - logprobs = [0., 0., 0.]
ã€‚</p>
<pre><code>* ä½†æ˜¯ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ¢¯åº¦åå‘ä¼ æ’­åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ° new_logprob=[3.3213, -4.9980, -3.8690]
</code></pre>
<p>ï¼Œå› æ­¤æ¯ä¸ªæ ‡è®°çš„ KL æƒ©ç½šå˜ä¸º kl = new_logprobs - logprobs = [-0.3315, -0.0426, 0.6351]
ã€‚</p>
<pre><code>* éšåï¼Œnon_score_reward = beta * kl
</code></pre>
<p>ï¼Œå…¶ä¸­ beta
æ˜¯ KL æƒ©ç½šç³»æ•° (\beta)ï¼Œå®ƒè¢«æ·»åŠ åˆ°ä»å¥–åŠ±æ¨¡å‹è·å¾—çš„ score
ä¸­ï¼Œä»¥åˆ›å»ºç”¨äºè®­ç»ƒçš„ rewards
ã€‚score
ä»…åœ¨æ¯ä¸ªå›åˆ ( episode ) ç»“æŸæ—¶ç»™å‡ºï¼Œå¯èƒ½ç±»ä¼¼äº [0.4]
ï¼Œç„¶åæˆ‘ä»¬æœ‰ rewards = [beta * -0.3315, beta * -0.0426, beta * 0.6351 + 0.4]
ã€‚</p>
<pre><code>* ä»£ç ä¸ºå¥–åŠ±æ·»åŠ äº†æ¯ä¸ªæ ‡è®°çš„ KL æƒ©ç½š (lm_human_preferences/train_policy.py#L150-L153)ï¼Œä»¥é˜»æ­¢ç­–ç•¥ä¸åŸå§‹ç­–ç•¥å·®å¼‚è¿‡å¤§ã€‚




* ä»¥ â€œusually, he wouldâ€ ä¸ºä¾‹ï¼Œå®ƒè¢«æ ‡è®°åŒ–ä¸º [23073, 11, 339, 561]
</code></pre>
<p>ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨ [23073]
ä½œä¸ºæŸ¥è¯¢ï¼Œ[11, 339, 561]
ä½œä¸ºå“åº”ã€‚ç„¶ååœ¨é»˜è®¤çš„ gpt2
å‚æ•°ä¸‹ï¼Œå“åº”æ ‡è®°å°†å…·æœ‰å‚è€ƒç­–ç•¥çš„å¯¹æ•°æ¦‚ç‡ logprobs=[-3.3213, -4.9980, -3.8690]
ã€‚</p>
<p>9.<strong>æ¯ä¸ªå°æ‰¹æ¬¡çš„å¥–åŠ±å’Œä¼˜åŠ¿ç™½åŒ–ï¼Œå¯é€‰æ‹©å‡å€¼å¹³ç§»</strong></p>
<pre><code>1. OAI å®ç°äº†ä¸€ä¸ªåä¸º whiten
</code></pre>
<p>çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ŒåŸºæœ¬ä¸Šé€šè¿‡å‡å»å…¶å‡å€¼ç„¶åé™¤ä»¥å…¶æ ‡å‡†å·®æ¥å¯¹ values
è¿›è¡Œå½’ä¸€åŒ–ã€‚å¯é€‰åœ°ï¼Œwhiten
å¯ä»¥é€šè¿‡ shift_mean=True
å°†ç™½åŒ–åçš„ values
å¹³ç§»åˆ°å‡å€¼ã€‚     <br>
defÂ whiten(values,Â shift_mean=True):<br>
Â Â Â Â mean,Â varÂ =Â torch.mean(values),Â torch.var(values,Â unbiased=False)<br>
Â Â Â Â whitenedÂ =Â (valuesÂ -Â mean)*Â torch.rsqrt(varÂ +Â 1e-8)<br>
Â Â Â Â ifÂ notÂ shift_mean:<br>
Â Â Â Â Â Â Â Â whitenedÂ +=Â mean<br>
Â Â Â Â returnÂ whitened</p>
<pre><code>2. åœ¨æ¯ä¸ªå°æ‰¹æ¬¡ä¸­ï¼ŒOAI ä½¿ç”¨ whiten(rewards, shift_mean=False)
</code></pre>
<p>å¯¹å¥–åŠ±è¿›è¡Œç™½åŒ–ï¼Œä¸å¯¹å‡å€¼è¿›è¡Œå¹³ç§»å¤„ç† (lm_human_preferences/train_policy.py#L325)ï¼Œå¹¶ä½¿ç”¨å¹³ç§»åçš„å‡å€¼å¯¹ä¼˜åŠ¿è¿›è¡Œç™½åŒ– whiten(advantages)
(lm_human_preferences/train_policy.py#L338)ã€‚</p>
<pre><code>3.**ä¼˜åŒ–æ³¨æ„äº‹é¡¹:**  å¦‚æœå°æ‰¹æ¬¡çš„æ•°é‡ä¸ºä¸€ (åœ¨æ­¤å¤ç°ä¸­æ˜¯è¿™ç§æƒ…å†µ)ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å¥–åŠ±è¿›è¡Œç™½åŒ–ã€è®¡ç®—å¹¶å¯¹ä¼˜åŠ¿è¿›è¡Œä¸€æ¬¡ç™½åŒ–ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸ä¼šæ”¹å˜ã€‚




4.**TensorFlow vs PyTorch æ³¨æ„äº‹é¡¹:**  tf.moments
</code></pre>
<p>ä¸ torch.var
çš„ä¸åŒè¡Œä¸º: ç”±äºæ–¹å·®è®¡ç®—æ–¹å¼ä¸åŒï¼ŒTorch å’Œ TensorFlow ä¸­çš„ç™½åŒ–è¡Œä¸ºä¸åŒ:     <br>
importÂ numpyÂ asÂ np<br>
importÂ tensorflowÂ asÂ tf<br>
importÂ torch</p>
<pre><code>    defÂ whiten_tf(values,Â shift_mean=True):  
    Â Â Â Â mean,Â varÂ =Â tf.nn.moments(values,Â axes=list(range(values.shape.rank)))  
    Â Â Â Â meanÂ =Â tf.Print(mean,Â [mean],Â 'mean',Â summarize=100)  
    Â Â Â Â varÂ =Â tf.Print(var,Â [var],Â 'var',Â summarize=100)  
    Â Â Â Â whitenedÂ =Â (valuesÂ -Â mean)*Â tf.rsqrt(varÂ +Â 1e-8)  
    Â Â Â Â ifÂ notÂ shift_mean:  
    Â Â Â Â Â Â Â Â whitenedÂ +=Â mean  
    Â Â Â Â returnÂ whitened  
      
    defÂ whiten_pt(values,Â shift_mean=True,Â unbiased=True):  
    Â Â Â Â mean,Â varÂ =Â torch.mean(values),Â torch.var(values,Â unbiased=unbiased)  
    Â Â Â Â print(&quot;mean&quot;,Â mean)  
    Â Â Â Â print(&quot;var&quot;,Â var)  
    Â Â Â Â whitenedÂ =Â (valuesÂ -Â mean)*Â torch.rsqrt(varÂ +Â 1e-8)  
    Â Â Â Â ifÂ notÂ shift_mean:  
    Â Â Â Â Â Â Â Â whitenedÂ +=Â mean  
    Â Â Â Â returnÂ whitened  
      
    rewardsÂ =Â np.array([  
    Â Â Â Â [1.2,Â 1.3,Â 1.4],  
    Â Â Â Â [1.5,Â 1.6,Â 1.7],  
    Â Â Â Â [1.8,Â 1.9,Â 2.0],  
    ])  
      
    withÂ tf.Session()Â asÂ sess:  
    Â Â Â Â print(sess.run(whiten_tf(tf.constant(rewards,Â dtype=tf.float32),Â shift_mean=False)))  
    Â Â Â Â print(whiten_pt(torch.tensor(rewards),Â shift_mean=False,Â unbiased=True))  
    Â Â Â Â print(whiten_pt(torch.tensor(rewards),Â shift_mean=False,Â unbiased=False))  
    
            
    mean[1.5999999]  
    var[0.0666666627]  
    [[0.05080712Â 0.4381051Â 0.8254035Â ]  
    [1.2127019Â 1.6000004Â 1.9872988Â ]  
    [2.3745968Â 2.7618952Â 3.1491938Â ]]  
    meanÂ tensor(1.6000,Â dtype=torch.float64)  
    varÂ tensor(0.0750,Â dtype=torch.float64)  
    tensor([[0.1394,Â 0.5046,Â 0.8697],  
    Â Â Â Â Â Â Â Â [1.2349,Â 1.6000,Â 1.9651],  
    Â Â Â Â Â Â Â Â [2.3303,Â 2.6954,Â 3.0606]],Â dtype=torch.float64)  
    meanÂ tensor(1.6000,Â dtype=torch.float64)  
    varÂ tensor(0.0667,Â dtype=torch.float64)  
    tensor([[0.0508,Â 0.4381,Â 0.8254],  
    Â Â Â Â Â Â Â Â [1.2127,Â 1.6000,Â 1.9873],  
    Â Â Â Â Â Â Â Â [2.3746,Â 2.7619,Â 3.1492]],Â dtype=torch.float64)  
</code></pre>
<p>10.<strong>è£å‰ªå€¼å‡½æ•°</strong></p>
<pre><code>1. ä¸åŸå§‹çš„ PPO ä¸€æ · (baselines/ppo2/model.py#L68-L75)ï¼Œå€¼å‡½æ•°è¢«è£å‰ª (lm_human_preferences/train_policy.py#L343-L348)ï¼Œæ–¹å¼ä¸ç­–ç•¥ç›®æ ‡ç±»ä¼¼ã€‚
</code></pre>
<p>11.<strong>è‡ªé€‚åº” KL æ•£åº¦</strong></p>
<pre><code>* KL æ•£åº¦æƒ©ç½šç³»æ•° (\beta) æ ¹æ®å½“å‰ç­–ç•¥ä¸å…ˆå‰ç­–ç•¥ä¹‹é—´çš„ KL æ•£åº¦è‡ªé€‚åº”ä¿®æ”¹ã€‚å¦‚æœ KL æ•£åº¦è¶…å‡ºé¢„å®šçš„ç›®æ ‡èŒƒå›´ï¼Œåˆ™è°ƒæ•´æƒ©ç½šç³»æ•°ä»¥ä½¿å…¶æ›´æ¥è¿‘ç›®æ ‡èŒƒå›´ (lm_human_preferences/train_policy.py#L115-L124)ã€‚å®ƒçš„å®ç°å¦‚ä¸‹:        
    classÂ AdaptiveKLController:  
    Â Â Â Â defÂ __init__(self,Â init_kl_coef,Â hparams):  
    Â Â Â Â Â Â Â Â self.valueÂ =Â init_kl_coef  
    Â Â Â Â Â Â Â Â self.hparamsÂ =Â hparams  
      
    Â Â Â Â defÂ update(self,Â current,Â n_steps):  
    Â Â Â Â Â Â Â Â targetÂ =Â self.hparams.target  
    Â Â Â Â Â Â Â Â proportional_errorÂ =Â np.clip(currentÂ /Â targetÂ -Â 1,Â -0.2,Â 0.2)  
    Â Â Â Â Â Â Â Â multÂ =Â 1Â +Â proportional_errorÂ *Â n_stepsÂ /Â self.hparams.horizon  
    Â Â Â Â Â Â Â Â self.valueÂ *=Â mult  
    
    




* å¯¹äºæœ¬å·¥ä½œä¸­ç ”ç©¶çš„ sentiment
</code></pre>
<p>å’Œ descriptiveness
ä»»åŠ¡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† init_kl_coef=0.15, hparams.target=6, hparams.horizon=10000
ã€‚</p>
<p>####<strong>PyTorch Adam ä¼˜åŒ–å™¨ä¸ RLHF ç›¸å…³çš„æ•°å€¼é—®é¢˜</strong></p>
<ul>
<li>
<p>è¿™ä¸ªå®ç°ç»†èŠ‚éå¸¸æœ‰è¶£ï¼Œå€¼å¾—ä¸“é—¨ä¸€èŠ‚æ¥è®¨è®ºã€‚</p>
</li>
<li>
<p>PyTorch çš„ Adam ä¼˜åŒ–å™¨ (torch.optim.Adam.html) ä¸ TensorFlow çš„ Adam ä¼˜åŒ–å™¨ (TF1 Adam åœ¨ tensorflow/v1.15.2/adam.pyï¼ŒTF2 Adam åœ¨ keras/adam.py#L26-L220) æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚å…·ä½“æ¥è¯´ï¼Œ<strong>PyTorch éµå¾ªäº† Kingma å’Œ Ba çš„ Adam è®ºæ–‡ä¸­çš„ç®—æ³• 1</strong>  (arxiv/1412.6980)ï¼Œè€Œ<strong>TensorFlow ä½¿ç”¨äº†è¯¥è®ºæ–‡ç¬¬ 2.1 èŠ‚å‰çš„å…¬å¼</strong> ï¼Œè¿™é‡Œæåˆ°çš„ epsilon
åœ¨è®ºæ–‡ä¸­ç§°ä¸º epsilon hat
ã€‚åœ¨ä¼ªä»£ç æ¯”è¾ƒä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å†…å®¹: <br>
###Â pytorchÂ adamÂ implementation:<br>
bias_correction1Â =Â 1Â -Â beta1Â **Â step<br>
bias_correction2Â =Â 1Â -Â beta2Â **Â step<br>
step_sizeÂ =Â lrÂ /Â bias_correction1<br>
bias_correction2_sqrtÂ =Â <em>dispatch_sqrt(bias_correction2)<br>
denomÂ =Â (exp_avg_sq.sqrt()Â /Â bias_correction2_sqrt).add</em>(eps)<br>
param.addcdiv_(exp_avg,Â denom,Â value=-step_size)</p>
<p>###Â tensorflowÂ adamÂ implementation:<br>
lr_tÂ =Â lrÂ *Â <em>dispatch_sqrt((1Â -Â beta2Â **Â step))Â /Â (1Â -Â beta1Â **Â step)<br>
denomÂ =Â exp_avg_sq.sqrt().add</em>(eps)<br>
param.addcdiv_(exp_avg,Â denom,Â value=-lr_t)</p>
</li>
<li>
<p>è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ PyTorch é£æ ¼å’Œ TensorFlow é£æ ¼ Adam çš„æ›´æ–°æ–¹ç¨‹ã€‚æŒ‰ç…§ Adam è®ºæ–‡ (Kingma å’Œ Baï¼Œ2014) çš„ç¬¦å·è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° PyTorch Adam (Kingma å’Œ Ba è®ºæ–‡çš„ç®—æ³• 1) å’Œ TensorFlow é£æ ¼ Adam (Kingma å’Œ Ba è®ºæ–‡ç¬¬ 2.1 èŠ‚å‰çš„å…¬å¼) çš„æ¢¯åº¦æ›´æ–°è§„åˆ™å¦‚ä¸‹:</p>
</li>
<li>
<p>ä¸Šé¢çš„æ–¹ç¨‹å¼ºè°ƒäº† PyTorch å’Œ TensorFlow å®ç°ä¹‹é—´çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„<strong>å½’ä¸€åŒ–é¡¹</strong> ï¼Œå³ (\color{green}{\varepsilon \sqrt{1-\beta_2^t}}) å’Œ (\color{green}{\hat{\varepsilon}})ã€‚å¦‚æœæˆ‘ä»¬è®¾ç½® (\hat{\varepsilon} = \varepsilon \sqrt{1-\beta_2^t})ï¼Œåˆ™è¿™ä¸¤ä¸ªç‰ˆæœ¬æ˜¯ç­‰ä»·çš„ã€‚ç„¶è€Œï¼Œåœ¨ PyTorch å’Œ TensorFlow çš„ API ä¸­ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ eps
å‚æ•°è®¾ç½® (\varepsilon) (PyTorch) å’Œ (\hat{\varepsilon}) (TensorFlow)ï¼Œä»è€Œå¯¼è‡´å®ƒä»¬çš„æ›´æ–°æ–¹ç¨‹å­˜åœ¨å·®å¼‚ã€‚å¦‚æœæˆ‘ä»¬å°† (\varepsilon) å’Œ (\hat{\varepsilon}) éƒ½è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œæ¯”å¦‚ 1e-5 ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿé‚£ä¹ˆå¯¹äº TensorFlow Adamï¼Œå½’ä¸€åŒ–é¡¹ (\hat{\varepsilon} = \text{1e-5}) å°±æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚ä½†å¯¹äº PyTorch Adamï¼Œå½’ä¸€åŒ–é¡¹ ({\varepsilon \sqrt{1-\beta_2^t}}) éšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚é‡è¦çš„æ˜¯ï¼Œå½“æ—¶é—´æ­¥ (t) è¾ƒå°æ—¶ï¼Œè¯¥é¡¹ ({\varepsilon \sqrt{1-\beta_2^t}}) æ˜æ˜¾å°äº 1e-5ï¼Œéšç€æ—¶é—´æ­¥å¢åŠ ï¼Œé€æ¸æ¥è¿‘ 1e-5ã€‚ä¸‹é¢çš„å›¾è¡¨æ¯”è¾ƒäº†è¿™ä¸¤ä¸ªå½’ä¸€åŒ–é¡¹éšç€æ—¶é—´æ­¥çš„å˜åŒ–æƒ…å†µ:</p>
</li>
</ul>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVrLf9cFGqTjq9QJ5PkTCUTS5rFeTzJa1sYF7hpP3XnKRZmCLMpCribNg/640?wx_fmt=png" alt="">norma_const_comparison.png</p>
<ul>
<li>
<p>ä¸Šå›¾æ˜¾ç¤ºï¼Œå¦‚æœæˆ‘ä»¬åœ¨ PyTorch Adam å’Œ TensorFlow Adam ä¸­è®¾ç½®ç›¸åŒçš„ eps
ï¼Œé‚£ä¹ˆåœ¨è®­ç»ƒçš„æ—©æœŸé˜¶æ®µï¼ŒPyTorch Adam ä½¿ç”¨çš„å½’ä¸€åŒ–é¡¹è¦æ¯” TensorFlow Adam å°å¾—å¤šã€‚æ¢å¥è¯è¯´ï¼ŒPyTorch Adam åœ¨è®­ç»ƒçš„æ—©æœŸé‡‡ç”¨äº†<strong>æ›´æ¿€è¿›çš„æ¢¯åº¦æ›´æ–°</strong> ã€‚æˆ‘ä»¬çš„å®éªŒè¯æ˜äº†è¿™ä¸€å‘ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
</li>
<li>
<p>è¿™å¯¹å¤ç°æ€§å’Œæ€§èƒ½æœ‰ä½•å½±å“ï¼Ÿä¸ºäº†ä¿æŒè®¾ç½®ä¸€è‡´ï¼Œæˆ‘ä»¬è®°å½•äº†æ¥è‡ª <a href="https://github.com/openai/lm-human-preferences">https://github.com/openai/lm-human-preferences</a> çš„åŸå§‹æŸ¥è¯¢ã€å“åº”å’Œå¥–åŠ±ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨ <a href="https://huggingface.co/datasets/vwxyzjn/lm-human-preferences-debug/tree/main">https://huggingface.co/datasets/vwxyzjn/lm-human-preferences-debug/tree/main</a> ä¸­ã€‚æˆ‘è¿˜è®°å½•äº†ä½¿ç”¨ TF1 çš„ AdamOptimizer
ä¼˜åŒ–å™¨çš„å‰ä¸¤ä¸ªè®­ç»ƒå‘¨æœŸçš„æŒ‡æ ‡ä½œä¸ºåŸºå‡†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®æŒ‡æ ‡:</p>
</li>
</ul>
<p>OAI çš„ TF1 AdamPyTorch çš„ Adamæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ä¼¼ TensorFlow é£æ ¼çš„ Adam</p>
<p>policy/approxkl
0.00037167023
0.0023672834504395723
0.000374998344341293</p>
<p>policy/clipfrac
0.0045572915
0.02018229104578495
0.0052083334885537624</p>
<p>ratio_mean
1.0051285
1.0105520486831665
1.0044583082199097</p>
<p>ratio_var
0.0007716546
0.005374275613576174
0.0007942612282931805</p>
<p>ratio_max
1.227216
1.8121057748794556
1.250215768814087</p>
<p>ratio_min
0.7400441
0.4011387825012207
0.7299948930740356</p>
<p>logprob_diff_mean
0.0047487603
0.008101251907646656
0.004073789343237877</p>
<p>logprob_diff_var
0.0007207897
0.004668936599045992
0.0007334011606872082</p>
<p>logprob_diff_max
0.20474821
0.594489574432373
0.22331619262695312</p>
<p>logprob_diff_min
-0.30104542
-0.9134478569030762
-0.31471776962280273</p>
<ul>
<li>
<p>ç”±äºæŸç§åŸå› ï¼Œ<strong>PyTorch çš„ Adam ç”Ÿæˆäº†æ›´æ¿€è¿›çš„æ›´æ–°</strong> ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è¯æ®:</p>
<p>*<strong>PyTorch çš„ Adam çš„ logprob_diff_var é«˜å‡º 6 å€</strong> ã€‚è¿™é‡Œçš„ logprobs_diff = new_logprobs - logprobs
æ˜¯ç»è¿‡ä¸¤ä¸ªè®­ç»ƒå‘¨æœŸåï¼Œåˆå§‹ç­–ç•¥å’Œå½“å‰ç­–ç•¥ä¹‹é—´çš„æ ‡è®°å¯¹æ•°æ¦‚ç‡å·®å¼‚ã€‚å…·æœ‰æ›´å¤§çš„ logprob_diff_var
æ„å‘³ç€å¯¹æ•°æ¦‚ç‡å˜åŒ–çš„å¹…åº¦æ¯” OAI çš„ TF1 Adam å¤§ã€‚</p>
<p>*<strong>PyTorch çš„ Adam å‘ˆç°æ›´æç«¯çš„æœ€å¤§å’Œæœ€å°æ¯”ç‡</strong> ã€‚è¿™é‡Œçš„ ratio = torch.exp(logprobs_diff)
ã€‚å…·æœ‰ ratio_max=1.8121057748794556
æ„å‘³ç€å¯¹äºæŸäº›æ ‡è®°ï¼Œåœ¨å½“å‰ç­–ç•¥ä¸‹æŠ½å–è¯¥æ ‡è®°çš„æ¦‚ç‡è¦æ¯” OAI çš„ TF1 Adam é«˜ 1.8 å€ï¼Œè€Œåè€…ä»…ä¸º 1.2 å€ã€‚</p>
<p>*<strong>æ›´å¤§çš„ policy/approxkl
å’Œ policy/clipfrac
<strong>ã€‚ç”±äºæ¿€è¿›çš„æ›´æ–°ï¼Œæ¯”ç‡è¢«å‰ªåˆ‡çš„æ¬¡æ•°</strong>å¤š 4.4 å€ï¼Œè¿‘ä¼¼çš„ KL æ•£åº¦å¤§ 6 å€</strong> ã€‚</p>
<ul>
<li>è¿™ç§æ¿€è¿›çš„æ›´æ–°å¯èƒ½ä¼šå¯¼è‡´è¿›ä¸€æ­¥çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒPyTorch çš„ Adam
ä¸­çš„logprob_diff_mean
è¦å¤§ 1.7 å€ï¼Œè¿™å°†å¯¹ä¸‹ä¸€ä¸ªå¥–åŠ±è®¡ç®—ä¸­çš„ KL æƒ©ç½šäº§ç”Ÿ 1.7 å€å¤§çš„å½±å“; è¿™å¯èƒ½ä¼šè¢«ç´¯ç§¯ã€‚å®é™…ä¸Šï¼Œè¿™å¯èƒ½ä¸è‘—åçš„ KL æ•£åº¦é—®é¢˜æœ‰å…³â€”â€” KL æƒ©ç½šè¿œå¤§äºå®ƒåº”è¯¥çš„å€¼ï¼Œæ¨¡å‹å¯èƒ½ä¼šæ›´å¤šåœ°å…³æ³¨å®ƒå¹¶è¿›è¡Œæ›´å¤šä¼˜åŒ–ï¼Œä»è€Œå¯¼è‡´è´Ÿçš„ KL æ•£åº¦ã€‚</li>
</ul>
</li>
</ul>
<p>*<strong>æ›´å¤§çš„æ¨¡å‹å—åˆ°æ›´å¤šå½±å“</strong> ã€‚æˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›å®éªŒï¼Œæ¯”è¾ƒäº† PyTorch çš„ Adam
(ä»£å· pt_adam
) å’Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ä¼¼ TensorFlow é£æ ¼çš„ Adam (ä»£å· tf_adam
) åœ¨ gpt2
å’Œ gpt2-xl
ä¸Šçš„æ€§èƒ½ã€‚æˆ‘ä»¬å‘ç°åœ¨ gpt2
ä¸‹æ€§èƒ½å¤§è‡´ç›¸ä¼¼; ä½†æ˜¯åœ¨ gpt2-xl
ä¸‹ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°äº†æ›´æ¿€è¿›çš„æ›´æ–°ï¼Œè¿™æ„å‘³ç€æ›´å¤§çš„æ¨¡å‹å—åˆ°äº†æ›´å¤šçš„å½±å“ã€‚</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVBSV4yeuc3kgcf11hU4jhzzKsytEib2w8QlqicZJj2PrEPic6y1RbZNmcw/640?wx_fmt=png" alt="">adam_gpt2.png<img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVVFPwx4huBs6CINGIgGWLk6nM4uCaPJtvvjJA8QxlvG8Kykia8ickrGwQ/640?wx_fmt=png" alt="">adam_gpt2_xl.png</p>
<pre><code>* å½“åœ¨ gpt2-xl
</code></pre>
<p>ä¸­åˆå§‹ç­–ç•¥æ›´æ–°æ›´ä¸ºæ¿€è¿›æ—¶ï¼Œè®­ç»ƒåŠ¨æ€ä¼šå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨ pt_adam
æ—¶ï¼Œsentiment
çš„ objective/kl
å’Œ objective/scores
å³°å€¼è¦å¤§å¾—å¤šï¼Œ <em>åœ¨å…¶ä¸­ä¸€ä¸ªéšæœºç§å­ä¸­ï¼Œæœ€å¤§çš„ KL å€¼è¾¾åˆ°äº† 17.5</em> ï¼Œè¿™è¡¨æ˜äº†ä¸å¸Œæœ›çš„è¿‡åº¦ä¼˜åŒ–ã€‚</p>
<pre><code>* æ­¤å¤–ï¼Œç”±äº KL æ›´å¤§ï¼Œè®¸å¤šå…¶ä»–è®­ç»ƒæŒ‡æ ‡ä¹Ÿå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æ›´å¤§çš„ clipfrac
</code></pre>
<p>(ratio
è¢« PPO çš„ç›®æ ‡è£å‰ªç³»æ•° 0.2 è£å‰ªçš„æ—¶é—´æ¯”ä¾‹) å’Œ approxkl
ã€‚</p>
<h4 id="å±€é™æ€§">å±€é™æ€§</h4>
<p>æ³¨æ„åˆ°è¿™é¡¹å·¥ä½œæ²¡æœ‰å°è¯•å¤ç° CNN DM ä¸­çš„æ‘˜è¦å·¥ä½œã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å‘ç°è®­ç»ƒè€—æ—¶ä¸”ä¸ç¨³å®šã€‚</p>
<p>æˆ‘ä»¬çš„ç‰¹å®šè®­ç»ƒè¿è¡Œæ˜¾ç¤º GPU åˆ©ç”¨ç‡è¾ƒä½ (çº¦ 30%)ï¼Œå› æ­¤ä¸€ä¸ªè®­ç»ƒè¿è¡Œéœ€è¦è¿‘ 4 å¤©çš„æ—¶é—´ï¼Œè¿™éå¸¸æ˜‚è´µ (åªæœ‰ AWS é”€å”® p3dn.24xlargeï¼Œæ¯å°æ—¶è´¹ç”¨ä¸º 31.212 ç¾å…ƒ)ã€‚</p>
<p>æ­¤å¤–ï¼Œè®­ç»ƒä¹Ÿå¾ˆä¸ç¨³å®šã€‚è™½ç„¶å¥–åŠ±å€¼ä¸Šå‡ï¼Œä½†æˆ‘ä»¬å‘ç°éš¾ä»¥å¤ç° Ziegler ç­‰äºº (2019 å¹´) æŠ¥å‘Šçš„â€œæ™ºèƒ½å¤åˆ¶â€è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ ·æœ¬è¾“å‡º â€” æ˜¾ç„¶ï¼Œæ™ºèƒ½ä½“å‡ºç°äº†æŸç§ç¨‹åº¦çš„è¿‡æ‹Ÿåˆã€‚è¯·æŸ¥çœ‹ <a href="https://wandb.ai/openrlbenchmark/lm-human-preferences/runs/1ab47rqi/logs">https://wandb.ai/openrlbenchmark/lm-human-preferences/runs/1ab47rqi/logs</a> ä»¥è·å–æ›´å®Œæ•´çš„æ—¥å¿—ã€‚</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVpxW0dd2VK3L7pSoCGSXf8UucmMpkHzBJJCvcEZib9iakO0ePV4lmibFYA/640?wx_fmt=png" alt="">tldr1.png<img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/5LJDib8HPR2rR7ia9MeO11GQ5vhgyTUdxVelCgNgYbiaIufY26f9FrGH2Q7g1KtkbosU8Fst7icNVmOSTzGlYmYrhQ/640?wx_fmt=png" alt="">tldr2.png</p>
<h4 id="æ€»ç»“">æ€»ç»“</h4>
<p>åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ·±å…¥ç ”ç©¶äº† OpenAI çš„åŸå§‹ RLHF (Reinforcement Learning from Human Feedback) ä»£ç åº“ï¼Œå¹¶ç¼–åˆ¶äº†å…¶å®æ–½ç»†èŠ‚çš„åˆ—è¡¨ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªæœ€å°çš„åŸºç¡€ç‰ˆæœ¬ï¼Œå½“æ•°æ®é›†å’Œè¶…å‚æ•°å—æ§åˆ¶æ—¶ï¼Œå¯ä»¥å¤ç°ä¸ OpenAI åŸå§‹ RLHF ä»£ç åº“ç›¸åŒçš„å­¦ä¹ æ›²çº¿ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è¯†åˆ«äº†ä¸€äº›ä»¤äººæƒŠè®¶çš„å®æ–½ç»†èŠ‚ï¼Œæ¯”å¦‚ Adam ä¼˜åŒ–å™¨çš„è®¾ç½®ï¼Œå®ƒä¼šå¯¼è‡´åœ¨ RLHF è®­ç»ƒçš„æ—©æœŸå‡ºç°æ¿€è¿›çš„æ›´æ–°ã€‚</p>
<h4 id="è‡´è°¢">è‡´è°¢</h4>
<p>è¿™é¡¹å·¥ä½œå¾—åˆ°äº† Hugging Face çš„ Big Science é›†ç¾¤çš„æ”¯æŒ ğŸ¤—ã€‚æˆ‘ä»¬è¿˜æ„Ÿè°¢ @lewtun å’Œ @natolambert çš„å»ºè®¾æ€§è®¨è®ºã€‚</p>
<h4 id="bibtex">Bibtex</h4>
<pre><code>@article{Huang2023implementation,  
  author = {Huang, Shengyi and Liu, Tianlin and von Werra, Leandro},  
  title = {The N Implementation Details of RLHF with PPO},  
  journal = {Hugging Face Blog},  
  year = {2023},  
  note = {https://huggingface.co/blog/the_n_implementation_details_of_rlhf_with_ppo},  
}  
</code></pre>
<blockquote>
<p>ğŸ¤— å¯ä»¥æˆ³<strong>é˜…è¯»åŸæ–‡</strong>  æŸ¥çœ‹æ–‡ä¸­æ‰€æœ‰çš„å¤–éƒ¨é“¾æ¥å“Ÿï¼</p>
</blockquote>
<h4 id="heading"></h4>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>è‹±æ–‡åŸæ–‡: <a href="https://hf.co/blog/the_n_implementation_details_of_rlhf_with_ppo">https://hf.co/blog/the_n_implementation_details_of_rlhf_with_ppo</a></p>
<p>åŸæ–‡ä½œè€…: Shengyi Costa Huang, Tianlin Liu, Leandro von We</p>
<p>è¯‘è€…: innovation64</p>
<p>å®¡æ ¡/æ’ç‰ˆ: zhongdongy (é˜¿ä¸œ)</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p><strong>è¿›æŠ€æœ¯äº¤æµç¾¤è¯·æ·»åŠ AINLPå°åŠ©æ‰‹å¾®ä¿¡ï¼ˆid:Â ainlp2)</strong></p>
<p><strong>è¯·å¤‡æ³¨å…·ä½“æ–¹å‘+æ‰€ç”¨åˆ°çš„ç›¸å…³æŠ€æœ¯ç‚¹</strong></p>
<pre><code>![](https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSJADkmZ2IX6Z23znAibuEevotDMq9iaMxiapK7jfMibiauGFkycicAJEs6x5U9SGyDJZ0S1tRed9TPNUUDQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1)
</code></pre>
<p><strong>å…³äºAINLP</strong></p>
<pre><code>AINLP æ˜¯ä¸€ä¸ªæœ‰è¶£æœ‰AIçš„è‡ªç„¶è¯­è¨€å¤„ç†ç¤¾åŒºï¼Œä¸“æ³¨äº AIã€NLPã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€æ¨èç®—æ³•ç­‰ç›¸å…³æŠ€æœ¯çš„åˆ†äº«ï¼Œä¸»é¢˜åŒ…æ‹¬LLMã€é¢„è®­ç»ƒæ¨¡å‹ã€è‡ªåŠ¨ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ã€æ™ºèƒ½é—®ç­”ã€èŠå¤©æœºå™¨äººã€æœºå™¨ç¿»è¯‘ã€çŸ¥è¯†å›¾è°±ã€æ¨èç³»ç»Ÿã€è®¡ç®—å¹¿å‘Šã€æ‹›è˜ä¿¡æ¯ã€æ±‚èŒç»éªŒåˆ†äº«ç­‰ï¼Œæ¬¢è¿å…³æ³¨ï¼åŠ æŠ€æœ¯äº¤æµç¾¤è¯·æ·»åŠ AINLPå°åŠ©æ‰‹å¾®ä¿¡(idï¼šainlp2)ï¼Œå¤‡æ³¨å·¥ä½œ/ç ”ç©¶æ–¹å‘+åŠ ç¾¤ç›®çš„ã€‚

  


  


![](https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_jpg/nW2ZPfuYqSKABHCqVVQkVYPrM4XY1vsd0iaeuXzyJnoFc8cibd5mYb4wdA3WMQtiaPVmr0XLZHMuVibqWncibpnTSnQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1)
</code></pre>
<p><strong>é˜…è¯»è‡³æ­¤äº†ï¼Œåˆ†äº«ã€ç‚¹èµã€åœ¨çœ‹ä¸‰é€‰ä¸€å§ğŸ™</strong></p>
<p>æ›´å¤šAIå·¥å…·ï¼Œå‚è€ƒ<a href="https://aibard123.com/">Github-AiBard123</a>ï¼Œ<a href="https://aibard123.com/">å›½å†…AiBard123</a></p>



          </div>

å¯å…³æ³¨æˆ‘ä»¬çš„å…¬ä¼—å·ï¼šæ¯å¤©AIæ–°å·¥å…·

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('å¤œé—´æ¨¡å¼å¼€å¯');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('å¤œé—´æ¨¡å¼å…³é—­');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","æ—¥é—´æ¨¡å¼");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","å¤œé—´æ¨¡å¼");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


