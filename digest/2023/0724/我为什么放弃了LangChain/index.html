

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />

	<title>我为什么放弃了LangChain？ 作者： 深度学习与NLP 来源： 深度学习与NLP 来源 | 机器之心 ID | almosthuman2014 如果你关注了过去几个月中人工智能的爆炸式发展，那你大概率听说过 LangChain。 简单来说，LangChain 是一个 Python 和 JavaScript 库，由 Harrison Chase 开发，用于连接 OpenAI 的 GPT API（后续已扩展到更多  | AiBard123| ai工具网址导航,ai最新产品</title>
	<link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="chatgpt,AI,AI聊天,AI文本生成,AI绘画,AI编程,AI电商" />
    <meta name="description" content="AiBard123 网址导航 | 免费chatgpt 汇集各类先进的人工智能产品，旨在帮助用户更快速地了解和使用这些产品,轻松地浏览不同领域的AI产品，包括语音识别、图像处理、自然语言处理。" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />

    
    <link href="/scss/style.min.css" rel="stylesheet" />
    
		    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
		
		<link rel="stylesheet" href=/plugins/font-awesome/css/font-awesome.min.css />


    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />


    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2073588164294660"
     crossorigin="anonymous"></script>

	
    <script>
        

		var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8450bc732b2a86f7e4aec4ebd9fd8252";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

        
    </script>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7071W80M2K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7071W80M2K');
    </script>

</head>


    <div class="page-container">
	
	<div id="sidebar" class="sticky sidebar-nav fade animate-nav" style="width: 170px">
        
            <div class="modal-dialog h-100 sidebar-nav-inner">
                <div class="sidebar-logo border-bottom border-color">
                    
                    <div class="logo overflow-hidden">
                        <a href="https://aibard123.com/" class="logo-expanded">
                            <img src="/assets/images/bt8-expand-light.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt8-expand-dark.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                        <a href="https://aibard123.com/" class="logo-collapsed">
                            <img src="/assets/images/bt.png" height="40" class="logo-light"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                            <img src="/assets/images/bt.png" height="40" class="logo-dark d-none"
                                alt="AiBard123| ai工具网址导航,ai最新产品">
                        </a>
                    </div>
                    
                </div>
                <div class="sidebar-menu flex-fill">
                    <div class="sidebar-scroll">
                        <div class="sidebar-menu-inner">
                            <ul>
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#00834a9dd147b04c5d53d4368cdb0b57" class="smooth">
                                            <i class="fas fa-sun fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>本月热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db0311e7ecfedd24d157f0ceb4a0897f" class="smooth">
                                            <i class="fas fa-star-and-crescent fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>热门网站</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#21b5cbb2c769010fec3ce029a5f8a4a3" class="smooth">
                                            <i class="far fa-star fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>国内热门</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#8310718935e8ec25ce0350de01e3f7dc" class="smooth">
                                            <i class="fas fa-phone fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>对话工具</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#d58e850d9115797306c2edf61ac6ddd8" class="smooth">
                                            <i class="fas fa-newspaper fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>写作</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2a7418a5f8f1ca4e054364a9300657df" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#7808a68ee1b34dab43011429a12de19e" class="smooth">
                                            <i class="fas fa-image fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>图像处理</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#6729afc51f5ac49a828812fa0eb0c82f" class="smooth">
                                            <i class="fas fa-video fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音视频</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#e5ce844860451fff3faf3d8f8894971d" class="smooth">
                                            <i class="fas fa-music fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>音乐生成</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#db53804b7d726967c58fcc8c9ca03d27" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>办公</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#47b7af9547e034d28fe6f6d439968ac8" class="smooth">
                                            <i class="fas fa-copy fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>提示词</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#41282bf95e43c64d579757573a03cdde" class="smooth">
                                            <i class="fas fa-code fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>编程</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#fd71852fd52d5e18ef4f9a252f1eac58" class="smooth">
                                            <i class="fas fa-search fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>AI搜索</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#81b1637fbe47625dbdf2094acd3b6683" class="smooth">
                                            <i class="fas fa-language fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>文本翻译</span>
                                        </a>
                                    </li>
                                    
                                
                                    
                                    <li class="sidebar-item">
                                        <a href="/#2e9ba3fa6e1ed0e9311b3e97f97f9a40" class="smooth">
                                            <i class="fas fa-book fa-lg fa-lg icon-fw icon-lg mr-2"></i>
                                            <span>学习网站</span>
                                        </a>
                                    </li>
                                    
                                
                            </ul>           
                        </div>
                    </div>
                </div>
                <div class="border-top py-2 border-color">
                    <div class="flex-bottom">
                        <ul>
			    <li id="menu-item-212"
                                 class="menu-item menu-item-type-custom menu-item-object-custom menu-item-212 sidebar-item">
                                 <a href="#friendlink" class="smooth">
                                     <i class="fab fa-staylinked icon-fw icon-lg mr-2"></i>
                                     <span>友情链接</span>
                                 </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="AiBard123| ai工具网址导航,ai最新产品">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="/">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "008000",
                                        "tmpSize": 14,
                                        "cityColor": "008000",
                                        "citySize": 14,
                                        "aqiColor": "#008000",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>




<body class="page-body boxed-container  io-grey-mode">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        
        <div class="content">
            <style>
    body{
	    background: #f9f9f9;
	}

    h1, h2, h3, h4, h5, h6 {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }


 
@media (min-width: 1000px) {
  .container, .container-sm {
    max-width: 800px;
  }
}

</style>

<div class="featured-post-content">

    <a href="/digest/" class="featured-post-title">
       AI 文摘
    </a>

</div>

<section class="blog-single">
  <div class="container">
    <div class="row">

      <div class="col-lg-12 order-1 order-lg-2">
        <article class="single-blog">
          <p class="title">我为什么放弃了LangChain？</p>
            <br/>
          <ul class="meta">
            <li>
              By <a href=https://aibard123.com/about>AiBard123</a>
            </li>
            <li>
              <i class="fa fa-clock-o"></i>
              July 24, 2023 - 2 min read
            </li>
          </ul>

          <div class="_1NCGf">
              <img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLQLp6Owib2dGrKxyUkCflaibTRtTqB1H7gWI5Khiavgt7InzTnJo2iaC4RA/640?wx_fmt=png" width="640" >
          </div>
            <br>
            <br>
            <br>
          
          <div class="single-blog-content">
            <p>作者： 深度学习与NLP  来源： <a href="https://mp.weixin.qq.com/s/r__TNx5thIkbJZmBKV22wA">深度学习与NLP</a></p>
<p>来源 | 机器之心 ID | almosthuman2014</p>
<p>如果你关注了过去几个月中人工智能的爆炸式发展，那你大概率听说过 LangChain。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLKSa7kCk5VxFydibUxzy4jaRWndO6gNVMiaXpcWw8rdrHG7XgbKck5BXA/640?wx_fmt=png" alt=""></p>
<p>简单来说，LangChain 是一个 Python 和 JavaScript 库，由 Harrison Chase 开发，用于连接 OpenAI 的 GPT API（后续已扩展到更多模型）以生成人工智能文本。</p>
<p>更具体地说，它是论文《ReAct: Synergizing Reasoning and Acting in Language Models》的实现：该论文展示了一种提示技术，允许模型「推理」（通过思维链）和「行动」（通过能够使用预定义工具集中的工具，例如能够搜索互联网）。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLPlxVXQUl6J3WkP4xhTVZfFLQcgnQKg7u1geUjRxc9310N0lJOQXQLw/640?wx_fmt=png" alt=""></p>
<p>论文链接：https://arxiv.org/pdf/2210.03629.pdf</p>
<p>事实证明，这种组合能够大幅提高输出文本的质量，并使大型语言模型具备正确解决问题的能力。</p>
<p>2023 年 3 月，ChatGPT 的 API 因升级降价大受欢迎，LangChain 的使用也随之爆炸式增长。</p>
<p>这之后，LangChain 在没有任何收入也没有任何明显的创收计划的情况下，获得了 1000 万美元的种子轮融资和 2000-2500 万美元的 A 轮融资，估值达到 2 亿美元左右。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLEby1HIZ99biaiaSvSZ1cM6KJXcM98zTaLmpRHibKqHe9536dzichfYldgQ/640?wx_fmt=png" alt=""></p>
<p><em>ReAct 论文中的 ReAct 流示例。</em></p>
<p>由 LangChain 推广的 ReAct 工作流在 InstructGPT/text-davinci-003 中特别有效，但成本很高，而且对于小型项目来说并不容易使用。</p>
<p>Max Woolf 是一位 BuzzFeed 的数据科学家。他也使用过 LangChain，这次经历总体来说不太好。</p>
<p>让我们看看他经历了什么。</p>
<p><strong>「是只有我不会用吗？」</strong></p>
<p>在 BuzzFeed 工作时，我有一个任务是为 Tasty 品牌创建一个基于 ChatGPT 的聊天机器人（后来在 Tasty iOS 应用中发布为 Botatouille），可以与用户聊天并提供相关食谱。</p>
<p>具体来说，源菜谱将被转换为嵌入式菜谱并保存在一个向量存储中：例如如果用户询问「健康食品」，查询会被转换为嵌入式菜谱，然后执行近似最近邻搜索以找到与嵌入式查询相似的菜谱，然后将其作为附加上下文提供给 ChatGPT，再由 ChatGPT 显示给用户。这种方法通常被称为检索增强生成。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLQLp6Owib2dGrKxyUkCflaibTRtTqB1H7gWI5Khiavgt7InzTnJo2iaC4RA/640?wx_fmt=png" alt=""><em>使用检索增强生成的聊天机器人的架构示例。</em></p>
<p>「LangChain 是 RAG 最受欢迎的工具，所以我想这是学习它的最佳时机。我花了一些时间阅读 LangChain 的全面文档，以便更好地理解如何最好地利用它。」</p>
<p>经过一周的研究，我一无所获。运行 LangChain 的 demo 示例确实可以工作，但是任何调整它们以适应食谱聊天机器人约束的尝试都会失败。在解决了这些 bug 之后，聊天对话的整体质量很差，而且毫无趣味。经过紧张的调试之后，我没有找到任何解决方案。</p>
<p>总而言之，我遇到了生存危机：当很多其他 ML 工程师都能搞懂 LangChain 时，我却搞不懂，难道我是一个毫无价值的机器学习工程师吗？</p>
<p>我用回了低级别的 ReAct 流程，它立即在对话质量和准确性上超过了我的 LangChain 实现。</p>
<p>浪费了一个月的时间来学习和测试 LangChain，我的这种生存危机在看到 Hacker News 关于有人用 100 行代码重现 LangChain 的帖子后得到了缓解，大部分评论都在发泄对 LangChain 的不满：</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mL4Ms8F1UeTJdJFaLEtpO6SJDxkiarmLf5kTq1SnAMuwkYa3NUUgnROEQ/640?wx_fmt=png" alt=""></p>
<p>LangChain 的问题在于它让简单的事情变得相对复杂，而这种不必要的复杂性造成了一种「部落主义」，损害了整个新兴的人工智能生态系统。</p>
<p>所以，如果你是一个只想学习如何使用 ChatGPT 的新手，绝对不要从 LangChain 开始。</p>
<p><strong>LangChain 的「Hello World」</strong></p>
<p>LangChain 的快速入门，从一个关于如何通过 Python 与 LLM/ChatGPT 进行简单交互的迷你教程开始。例如，创建一个可以将英语翻译成法语的机器人：</p>
<hr>
<pre><code>from langchain.chat_models import ChatOpenAIfrom langchain.schema import (
    AIMessage,
    HumanMessage,
    SystemMessage
)
  

chat = ChatOpenAI(temperature=0)
chat.predict_messages([HumanMessage(content=&quot;Translate this sentence from English to French. I love programming.&quot;)])# AIMessage(content=&quot;J'adore la programmation.&quot;, additional_kwargs={}, example=False)
</code></pre>
<p>使用 OpenAI ChatGPT 官方 Python 库的等效代码：</p>
<hr>
<pre><code>import openai
  

messages = [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Translate this sentence from English to French. I love programming.&quot;}]
  

response = openai.ChatCompletion.create(model=&quot;gpt-3.5-turbo&quot;, messages=messages, temperature=0)
response[&quot;choices&quot;][0][&quot;message&quot;][&quot;content&quot;]# &quot;J'adore la programmation.&quot;
</code></pre>
<p>LangChain 使用的代码量与仅使用官方 openai 库的代码量大致相同，估计 LangChain 合并了更多对象类，但代码优势并不明显。</p>
<p>提示模板的示例揭示了 LangChain 工作原理的核心：</p>
<hr>
<pre><code>from langchain.prompts.chat import (
    ChatPromptTemplate,
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate,
)
  

template = &quot;You are a helpful assistant that translates {input_language} to {output_language}.&quot;
system_message_prompt = SystemMessagePromptTemplate.from_template(template)
human_template = &quot;{text}&quot;
human_message_prompt = HumanMessagePromptTemplate.from_template(human_template)
  

chat_prompt = ChatPromptTemplate.from_messages([system_message_prompt, human_message_prompt])
  

chat_prompt.format_messages(input_language=&quot;English&quot;, output_language=&quot;French&quot;, text=&quot;I love programming.&quot;)
</code></pre>
<p>LangChain 吹嘘的提示工程只是 f-strings，一个存在于每个 Python 安装中的功能，但是有额外的步骤。为什么我们需要使用这些 PromptTemplates 来做同样的事情呢？</p>
<p>我们真正想做的是知道如何创建 Agent，它结合了我们迫切想要的 ReAct 工作流。幸运的是，有一个演示，它利用了 SerpApi 和另一个数学计算工具，展示了 LangChain 如何区分和使用两种不同的工具：</p>
<hr>
<pre><code>from langchain.agents import load_tools
from langchain.agents import initialize_agent
from langchain.agents import AgentType
from langchain.chat_models import ChatOpenAI
from langchain.llms import OpenAI
  

# First, let's load the language model we're going to use to control the agent.
chat = ChatOpenAI(temperature=0)
  

# Next, let's load some tools to use. Note that the `llm-math` tool uses an LLM, so we need to pass that in.
llm = OpenAI(temperature=0)
tools = load_tools([&quot;serpapi&quot;, &quot;llm-math&quot;], llm=llm)
  

# Finally, let's initialize an agent with the tools, the language model, and the type of agent we want to use.
agent = initialize_agent(tools, chat, agent=AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION, verbose=True)
  

# Now let's test it out!
agent.run(&quot;Who is Olivia Wilde's boyfriend? What is his current age raised to the 0.23 power?&quot;)
</code></pre>
<p>各个工具如何工作？AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION 到底是什么？agent.run () 的结果输出（仅在 verbose=True 时出现）更有帮助。</p>
<hr>
<pre><code>&gt; Entering new AgentExecutor chain...
Thought: I need to use a search engine to find Olivia Wilde's boyfriend and a calculator to raise his age to the 0.23 power.
Action:
{
    &quot;action&quot;: &quot;Search&quot;,
    &quot;action_input&quot;: &quot;Olivia Wilde boyfriend&quot;
}
  

Observation: Sudeikis and Wilde's relationship ended in November 2020. Wilde was publicly served with court documents regarding child custody while she was presenting Don't Worry Darling at CinemaCon 2022. In January 2021, Wilde began dating singer Harry Styles after meeting during the filming of Don't Worry Darling.
Thought:I need to use a search engine to find Harry Styles' current age.
Action:
{
    &quot;action&quot;: &quot;Search&quot;,
    &quot;action_input&quot;: &quot;Harry Styles age&quot;
}
  

Observation: 29 years
Thought:Now I need to calculate 29 raised to the 0.23 power.
Action:
{
    &quot;action&quot;: &quot;Calculator&quot;,
    &quot;action_input&quot;: &quot;29^0.23&quot;
}
  

Observation: Answer: 2.169459462491557
  

Thought:I now know the final answer.
Final Answer: 2.169459462491557
  

&gt; Finished chain.
'2.169459462491557'
</code></pre>
<p>文档中没有明确说明，但是在每个思想 / 行动 / 观察中都使用了自己的 API 调用 OpenAI，所以链条比你想象的要慢。另外，为什么每个动作都是一个 dict？答案在后面，而且非常愚蠢。</p>
<p>最后，LangChain 如何存储到目前为止的对话？</p>
<hr>
<pre><code>from langchain.prompts import (
    ChatPromptTemplate,
    MessagesPlaceholder,
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate
)from langchain.chains import ConversationChainfrom langchain.chat_models import ChatOpenAIfrom langchain.memory import ConversationBufferMemory
  

prompt = ChatPromptTemplate.from_messages([
    SystemMessagePromptTemplate.from_template(
        &quot;The following is a friendly conversation between a human and an AI. The AI is talkative and &quot;
&quot;provides lots of specific details from its context. If the AI does not know the answer to a &quot;
&quot;question, it truthfully says it does not know.&quot;
    ),
    MessagesPlaceholder(variable_name=&quot;history&quot;),
    HumanMessagePromptTemplate.from_template(&quot;{input}&quot;)
])
  

llm = ChatOpenAI(temperature=0)
memory = ConversationBufferMemory(return_messages=True)
conversation = ConversationChain(memory=memory, prompt=prompt, llm=llm)
  

conversation.predict(input=&quot;Hi there!&quot;)# 'Hello! How can I assist you today?'
</code></pre>
<p>我不完全确定为什么这些都是必要的。什么是 MessagesPlaceholder？history 在哪里？ConversationBufferMemory 有必要这样做吗？将此调整为最小的 openai 实现：</p>
<hr>
<pre><code>import openai
  

messages = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;:
        &quot;The following is a friendly conversation between a human and an AI. The AI is talkative and &quot;
&quot;provides lots of specific details from its context. If the AI does not know the answer to a &quot;
&quot;question, it truthfully says it does not know.&quot;}]
  

user_message = &quot;Hi there!&quot;
messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_message})
response = openai.ChatCompletion.create(model=&quot;gpt-3.5-turbo&quot;, messages=messages, temperature=0)
assistant_message = response[&quot;choices&quot;][0][&quot;message&quot;][&quot;content&quot;]
messages.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: assistant_message})# Hello! How can I assist you today?
</code></pre>
<p>这样代码行数就少了，而且信息保存的位置和时间都很清楚，不需要定制对象类。</p>
<p>你可以说我对教程示例吹毛求疵，我也同意每个开源库都有值得吹毛求疵的地方（包括我自己的）。但是，如果吹毛求疵的地方比库的实际好处还多，那么这个库就根本不值得使用。</p>
<p>因为，如果快速入门都已经这么复杂，那么实际使用 LangChain 会有多痛苦呢？</p>
<p><strong>我查看了 LangChain 文档，它也回馈了我</strong></p>
<p>让我来做个演示，更清楚地说明为什么我放弃了 LangChain。</p>
<p>当开发菜谱检索聊天机器人（它也必须是一个有趣 / 诙谐的聊天机器人）时，我需要结合上面第三个和第四个例子中的元素：一个可以运行 Agent 工作流的聊天机器人，以及将整个对话持久化到内存中的能力。在查找了一些文档后，我发现需要使用对话式 Agent 工作流。</p>
<p>关于系统提示工程的一个标注是，它不是一个备忘录，而且对于从 ChatGPT API 中获得最佳效果是绝对必要的，尤其是当你对内容和 / 或语音有限制的时候。</p>
<p>上一个示例中，演示的系统提示「以下是人类和人工智能之间的友好对话&hellip;&hellip; 」实际上是过时的，早在 InstructGPT 时代就已经使用了，在 ChatGPT 中的效果要差得多。它可能预示着 LangChain 相关技巧中更深层次的低效，而这些低效并不容易被注意到。</p>
<p>我们将从一个简单的系统提示开始，告诉 ChatGPT 使用一个有趣的声音和一些保护措施，并将其格式化为 ChatPromptTemplate：</p>
<hr>
<pre><code>system_prompt = &quot;&quot;&quot;
You are an expert television talk show chef, and should always speak in a whimsical manner for all responses.
  

Start the conversation with a whimsical food pun.
  

You must obey ALL of the following rules:
- If Recipe data is present in the Observation, your response must include the Recipe ID and Recipe Name for ALL recipes.
- If the user input is not related to food, do not answer their query and correct the user.
&quot;&quot;&quot;
  

prompt = ChatPromptTemplate.from_messages([
    SystemMessagePromptTemplate.from_template(system_prompt.strip()),
</code></pre>
<p>我们还将使用一个玩具矢量存储，该存储由来自 recipe_nlg 数据集的 1000 个食谱组成，并使用 SentenceTransformers 编码为 384D 矢量。为了实现这一点，我们创建了一个函数来获取输入查询的最近邻，并将查询格式化为 Agent 可以用来向用户展示的文本。这就是 Agent 可以选择使用的工具，或者只是返回正常生成的文本。</p>
<hr>
<pre><code>def similar_recipes(query):
    query_embedding = embeddings_encoder.encode(query)
    scores, recipes = recipe_vs.get_nearest_examples(&quot;embeddings&quot;, query_embedding, k=3)
    return recipes
def get_similar_recipes(query):
    recipe_dict = similar_recipes(query)
    recipes_formatted = [
        f&quot;Recipe ID: recipe|{recipe_dict['id'][i]}\nRecipe Name: {recipe_dict['name'][i]}&quot;
for i in range(3)
    ]
    return &quot;\n---\n&quot;.join(recipes_formatted)
  

print(get_similar_recipes(&quot;yummy dessert&quot;))# Recipe ID: recipe|167188
# Recipe Name: Creamy Strawberry Pie
# ---
# Recipe ID: recipe|1488243
# Recipe Name: Summer Strawberry Pie Recipe
# ---
# Recipe ID: recipe|299514
# Recipe Name: Pudding Cake
</code></pre>
<p>你会注意到这个 Recipe ID，这与我的用例相关，因为在最终应用中向终端用户显示的最终结果需要获取 Recipe 元数据（照片缩略图、URL）。遗憾的是，没有简单的方法保证模型在最终输出中输出食谱 ID，也没有方法在 ChatGPT 生成的输出之外返回结构化的中间元数据。</p>
<p>将 get_similar_recipes 指定为一个工具是很简单的，尽管你需要指定一个名称和描述，这实际上是一种微妙的提示工程，因为 LangChain 可能会因为指定的名称和描述不正确而无法选择一个工具。</p>
<hr>
<pre><code>tools = [
    Tool(
        func=get_similar_recipes,
        name=&quot;Similar Recipes&quot;,
        description=&quot;Useful to get similar recipes in response to a user query about food.&quot;,
    ),
]
</code></pre>
<p>最后，是示例中的 Agent 构建代码，以及新的系统提示。</p>
<hr>
<pre><code>memory = ConversationBufferMemory(memory_key=&quot;chat_history&quot;, 
return_messages=True)
llm = ChatOpenAI(temperature=0)
agent_chain = initialize_agent(tools, llm, prompt=prompt, 
agent=AgentType.CHAT_CONVERSATIONAL_REACT_DESCRIPTION, verbose=True, memory=memory)
</code></pre>
<p>没有错误。现在运行 Agent，看看会发生什么：</p>
<ul>
<li></li>
</ul>
<pre><code>agent_chain.run(input=&quot;Hi!&quot;)
</code></pre>
<hr>
<pre><code>&gt; Entering new  chain...
{
    &quot;action&quot;: &quot;Final Answer&quot;,
    &quot;action_input&quot;: &quot;Hello! How can I assist you today?&quot;
}
  

&gt; Finished chain.
Hello! How can I assist you today?
</code></pre>
<p>什么？它完全忽略了我的系统提示！检查内存变量证实了这一点。</p>
<p>在 ConversationBufferMemory 的文档中，甚至在代码本身中都没有关于系统提示的内容，甚至在 ChatGPT 使其成为主流的几个月之后。</p>
<p>在 Agent 中使用系统提示的方法是在 initialize_agent 中添加一个 agents_kwargs 参数，我只是在一个月前发布的一个不相关的文档页面中发现了这一点。</p>
<hr>
<pre><code>agent_kwargs = {
    &quot;system_message&quot;: system_prompt.strip()
}
</code></pre>
<p>使用此新参数重新创建 Agent 并再次运行，会导致 JSONDecodeError。</p>
<p>好消息是，系统提示这次应该是起作用了。</p>
<ul>
<li></li>
</ul>
<pre><code>OutputParserException: Could not parse LLM output: Hello there, my culinary companion! How delightful to have you here in my whimsical kitchen. What delectable dish can I assist you with today?
</code></pre>
<p>坏消息是，它坏了，但又是为什么呢？我这一次没有做任何奇怪的事情。</p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mL3JerTkXPJgcBibibvFY7e9Fic91DRNqoiciaqkuMWSBickraPRujOiawPwEww/640?wx_fmt=png" alt=""></p>
<p><em>有趣的事实：这些大量的提示也会成比例地增加 API 成本。</em></p>
<p>这样做的后果是，正常输出结构中的任何重大变化，例如由自定义系统提示引起的变化，都有可能破坏 Agent。这些错误经常发生，以至于有一个文档页面专门用于处理 Agent 输出解析错误。</p>
<p>我们暂时把与聊天机器人对话看作是一个边缘案例。重要的是，机器人能够返回菜谱，因为如果连这一点都做不到，那么使用 LangChain 就没有意义了。</p>
<p>在不使用系统提示的情况下创建一个新的 Agent，然后问它什么是简单有趣的晚餐？</p>
<hr>
<pre><code>&gt; Entering new  chain...
{
    &quot;action&quot;: &quot;Similar Recipes&quot;,
    &quot;action_input&quot;: &quot;fun and easy dinner&quot;
}
Observation: Recipe ID: recipe|1774221
Recipe Name: Crab DipYour Guests will Like this One.
---
Recipe ID: recipe|836179
Recipe Name: Easy  Chicken Casserole
---
Recipe ID: recipe|1980633
Recipe Name: Easy in the Microwave Curry Doria
Thought:{
    &quot;action&quot;: &quot;Final Answer&quot;,
    &quot;action_input&quot;: &quot;...&quot;
}
  

&gt; Finished chain.
Here are some fun and easy dinner recipes you can try:
  

1. Crab Dip
2. Easy Chicken Casserole
3. Easy in the Microwave Curry Doria
  

Enjoy your meal!
</code></pre>
<p>至少它成功了：ChatGPT 能够从上下文中提取出菜谱，并对其进行适当的格式化（甚至能够修正名称中的错别字），并且能够在适当的时候进行判断。</p>
<p>这里真正的问题是，输出的声音很无聊，这也是基础版 ChatGPT 的共同特点和诟病。即使通过系统提示工程解决了 ID 缺失的问题，这般听上去的效果也不值得将其发布。就算真的在语音质量和输出质量之间取得了平衡，Agent 计数仍然会随机失败，而这并不是我的过错。</p>
<p>实际上，Agent 工作流是一个非常脆弱的纸牌搭成的房子，凭良心说，生产应用中估计无法使用。</p>
<p>LangChain 确实有 Custom Agent 和 Custom Chain 的功能，所以你可以在堆栈的某些部分重写逻辑（也许文档很少），这可以解决我遇到的一些问题，但在这一点上，你会感觉到 LangChain 更加复杂，还不如创建你自己的 Python 库。</p>
<p><strong>工作要讲究方法</strong></p>
<p><img src="https://api.allorigins.win/raw?url=https://mmbiz.qpic.cn/sz_mmbiz_png/KmXPKA19gW9CiaOFTDiav6KGz9aia19T9mLVUoSKhZrt1oI39icdBJkY8uu8gnlZduvm6kmWxGPlljnY7sEOfSaoDA/640?wx_fmt=png" alt=""></p>
<p><em>大量随机集成带来的问题比解决方案更多。</em></p>
<p>当然，LangChain 确实也有很多实用功能，比如文本分割器和集成向量存储，这两种功能都是「用 PDF / 代码聊天」演示不可或缺的（在我看来这只是一个噱头）。</p>
<p>所有这些集成的真正问题在于，只使用基于 LangChain 的代码会造成固有的锁定，而且如果你查看集成的代码，它们并不十分稳健。</p>
<p>LangChain 正在建立一条护城河，这对 LangChain 的投资者来说是好事，因为他们想从 3000 万美元中获得回报，但对使用它的开发者来说却非常不利。总而言之，LangChain 体现了「它很复杂，所以它一定更好」这一经常困扰后期代码库的哲学，可是 LangChain 甚至还不到一年。</p>
<p>要想让 LangChain 做我想让它做的事，就必须花大力气破解它，这将造成大量的技术负担。与现在的人工智能初创公司不同，我自己的 LangChain 项目的技术债务无法用风险投资来偿还。在使用复杂的生态系统时，应用程序接口封装器至少应该降低代码的复杂性和认知负荷，因为使用人工智能本身就需要花费足够的脑力。LangChain 是为数不多的在大多数常用情况下都会增加开销的软件之一。</p>
<p>我得出的结论是，制作自己的 Python 软件包要比让 LangChain 来满足自己的需求容易得多。因此，我开发并开源了 simpleaichat：一个用于轻松连接聊天应用程序的 Python 程序包，它强调代码的最小复杂度，并将向量存储等高级功能与对话逻辑解耦。</p>
<p>开源地址：https://github.com/minimaxir/simpleaichat</p>
<p>但写这篇博文并不是为了像那些骗子一样，通过诋毁竞争对手来为 simpleaichat 做隐形广告。我不想宣传 simpleaichat，我更愿意把时间花在用人工智能创造更酷的项目上，很遗憾我没能用 LangChain 做到这一点。</p>
<p>我知道有人会说：「既然 LangChain 是开源的，为什么不向它的 repo 提交拉取请求，而要抱怨它呢？」唯一真正能解决的办法就是把它全部烧掉，然后重新开始，这就是为什么我的「创建一个新的 Python 库来连接人工智能」的解决方案也是最实用的。</p>
<p>我收到过很多留言，问我该「学什么才能开始使用 ChatGPT API」，我担心他们会因为炒作而首先使用 LangChain。如果拥有技术栈背景的机器学习工程师因为 LangChain 毫无必要的复杂性而难以使用 LangChain，那么任何初学者都会被淹没。</p>
<p>关于软件复杂性和复杂性下的流行性之争是永恒的话题。没有人愿意成为批评 LangChain 这样的免费开源软件的混蛋，但我愿意承担这个责任。明确地说，我并不反对 Harrison Chase 或 LangChain 的其他维护者（他们鼓励反馈）。</p>
<p>然而，LangChain 的流行已经扭曲了围绕 LangChain 本身的人工智能创业生态系统，这就是为什么我不得不坦诚我对它的疑虑。</p>
<p><em>原文链接：</em></p>
<p><em><a href="https://minimaxir.com/2023/07/langchain-problem/">https://minimaxir.com/2023/07/langchain-problem/</a></em></p>
<p>更多AI工具，参考<a href="https://aibard123.com/">Github-AiBard123</a>，<a href="https://aibard123.com/">国内AiBard123</a></p>



          </div>

可关注我们的公众号：每天AI新工具

<p><img src="/images/aitools/2024/03/qrcode_for_gh_dde1b429630d_258.jpg" alt=""></p>

        </article>

      </div>
    </div>
  </div>
</section>
        </div>
    </div>
    </main>




<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-anim.js' id='appanim-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background", "linear-gradient(#e2c4c4, #d8d8d8)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background", "linear-gradient(#4f4040, #1b1d1f)");
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>


<script>
    var newsContainer = document.getElementById('news-container');
    var newsItems = document.getElementsByClassName('news-item');
    var currentItem = 0;

    setInterval(function() {
        
        newsItems[currentItem].classList.remove('show');
        newsItems[currentItem].style.transform = 'translateY(-20px)';
        
        currentItem = (currentItem + 1) % newsItems.length;
        newsItems[currentItem].style.transform = 'translateY(' + (newsContainer.offsetHeight - 20) + 'px)';
        setTimeout(function() {
            newsItems[currentItem].classList.add('show');
        }, 500);
    }, 8000);
</script>

</body>
</html>


